import{_ as a,W as s,X as i,Y as e,Z as t,$ as o,a0 as n,y as l}from"./framework.cf23f0c7.js";const c={},d=e("h1",{id:"介绍",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#介绍","aria-hidden":"true"},"#"),t(" 介绍")],-1),p={href:"http://ASP.NET",target:"_blank",rel:"noopener noreferrer"},h=e("blockquote",null,[e("p",null,"本次示例环境：Windows Server 2012 R2 、vs2019、MySQL、.net5")],-1),g=e("h1",{id:"安装环境",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#安装环境","aria-hidden":"true"},"#"),t(" 安装环境")],-1),_=e("h2",{id:"支持平台",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#支持平台","aria-hidden":"true"},"#"),t(" 支持平台")],-1),m=e("ul",null,[e("li",null,"Windows 7 或更高版本"),e("li",null,"Windows Server 2012 R2 或更高版本")],-1),u=e("blockquote",null,[e("p",null,"本次代码将安装在Windows Server 2012 R2 版本上，感觉这个版本使用的公司还不少。")],-1),f={id:"安装asp-net-core托管捆绑包",tabindex:"-1"},b=e("a",{class:"header-anchor",href:"#安装asp-net-core托管捆绑包","aria-hidden":"true"},"#",-1),N={href:"http://xn--ASP-pd0fq01r.NET",target:"_blank",rel:"noopener noreferrer"},k={href:"https://dotnet.microsoft.com/download/dotnet/thank-you/runtime-aspnetcore-5.0.6-windows-hosting-bundle-installer",target:"_blank",rel:"noopener noreferrer"},A={href:"https://docs.microsoft.com/zh-cn/aspnet/core/host-and-deploy/iis/hosting-bundle?view=aspnetcore-5.0",target:"_blank",rel:"noopener noreferrer"},S={href:"https://docs.microsoft.com/zh-cn/aspnet/core/host-and-deploy/aspnet-core-module?view=aspnetcore-5.0",target:"_blank",rel:"noopener noreferrer"},v={href:"http://ASP.NET",target:"_blank",rel:"noopener noreferrer"},w=n('<p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621430404995-81a66bf0-d43f-432c-931d-c9da9239912d.png" alt="image.png" loading="lazy"></p><p>安装后查看应用程序目录</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621432192325-6321b024-3a82-47d8-8b2b-cd8d4fbe2e13.png" alt="image.png" loading="lazy"></p><h1 id="发布项目" tabindex="-1"><a class="header-anchor" href="#发布项目" aria-hidden="true">#</a> 发布项目</h1><p>新建一个net5 WebAPI程序，当前程序主要包含一个用户控制器(包含用户信息的增删改查)并且连接MySQL数据库。</p><p>项目结构如下</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621431500383-f3718698-75cb-4cc1-971f-a94987fd728a.png" alt="image.png" loading="lazy"></p>',7),x={href:"https://gitee.com/AZRNG/my-example",target:"_blank",rel:"noopener noreferrer"},P=e("p",null,"通过vs2019发布我们的项目，然后将发布后的项目拷贝到要部署的服务器上面。",-1),y=e("p",null,[e("img",{src:"https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621432479264-a4ad0599-9c44-48f8-9f60-66e4b2e92c6f.png",alt:"image.png",loading:"lazy"})],-1),E=e("p",null,"发布后如下",-1),T=e("p",null,[e("img",{src:"https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621432762660-7cbee968-8fb8-4506-a44c-86f91c08eca9.png",alt:"image.png",loading:"lazy"})],-1),I={href:"http://ASP.NET",target:"_blank",rel:"noopener noreferrer"},z=e("h1",{id:"托管方式",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#托管方式","aria-hidden":"true"},"#"),t(" 托管方式")],-1),C=e("h2",{id:"进程内托管-iis-http-服务器",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#进程内托管-iis-http-服务器","aria-hidden":"true"},"#"),t(" 进程内托管(IIS HTTP 服务器)")],-1),G={href:"http://ASP.NET",target:"_blank",rel:"noopener noreferrer"},R={href:"http://ASP.NET",target:"_blank",rel:"noopener noreferrer"},Z=e("p",null,[e("img",{src:"https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621418975218-e1cf8916-d1b1-4478-ab06-27d68955f2cd.png",alt:"image",loading:"lazy"})],-1),q={href:"http://ASP.NET",target:"_blank",rel:"noopener noreferrer"},W=n(`<p>显式配置进行内托管，需要在项目文件(.csproj)中增加如下配置</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;PropertyGroup&gt;
  &lt;AspNetCoreHostingModel&gt;InProcess&lt;/AspNetCoreHostingModel&gt;
&lt;/PropertyGroup&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="进程外托管-kestrel服务器" tabindex="-1"><a class="header-anchor" href="#进程外托管-kestrel服务器" aria-hidden="true">#</a> 进程外托管(Kestrel服务器)</h2>`,3),M={href:"http://ASP.NET",target:"_blank",rel:"noopener noreferrer"},H={href:"http://xn--ASP-vs9dw89f.NET",target:"_blank",rel:"noopener noreferrer"},L=e("p",null,[e("img",{src:"https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621419731758-573dae98-6398-4ff8-b74e-3bed05092e05.png",alt:"image",loading:"lazy"})],-1),O={href:"http://ASP.NET",target:"_blank",rel:"noopener noreferrer"},V=n(`<p>进程外托管配置，在项目文件 ( .csproj) 中将 &lt;AspNetCoreHostingModel&gt; 属性的值设置为 OutOfProcess</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;PropertyGroup&gt;
  &lt;AspNetCoreHostingModel&gt;OutOfProcess&lt;/AspNetCoreHostingModel&gt;
&lt;/PropertyGroup&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),B={href:"https://docs.microsoft.com/zh-cn/aspnet/core/host-and-deploy/iis/in-process-hosting?view=aspnetcore-5.0#differences-between-in-process-and-out-of-process-hosting",target:"_blank",rel:"noopener noreferrer"},j=n('<h1 id="部署项目" tabindex="-1"><a class="header-anchor" href="#部署项目" aria-hidden="true">#</a> 部署项目</h1><p>将项目进行发布，然后拷贝到我们的服务器一个文件夹内。</p><p>打开IIS添加网站，选择物理路径为我们项目文件</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621434077105-2e447da1-5082-4ac9-87c2-a22c7bcf825c.png" alt="image.png" loading="lazy"></p><p>修改应用程序池为无托管模式</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621434518735-f09c0f97-ea01-490a-be38-dbf59d5ab886.png" alt="image.png" loading="lazy"></p><p>启动程序转到swagger页面</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621434688002-1abc9d39-c4a4-435c-88e8-5ff52ece4db7.png" alt="image.png" loading="lazy"></p><p>因为当前我并没有连接数据库，直接调用接口应该报错，我们看下错误日志。启动输出日志</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621434770504-dcf4f9c6-7481-496d-8cd1-0a02094edde8.png" alt="image.png" loading="lazy"></p><p>说明我们项目已经部署成功了</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621434890333-450eab2d-434a-491d-9b95-d68d1648662a.png" alt="image.png" loading="lazy"></p>',12),Q={href:"https://docs.microsoft.com/zh-cn/aspnet/core/test/troubleshoot-azure-iis?view=aspnetcore-5.0",target:"_blank",rel:"noopener noreferrer"},K={href:"http://xn--6qqt3c53chze7wdyxsm8i5w3ce6sp3qizp.net",target:"_blank",rel:"noopener noreferrer"},X=e("h1",{id:"参考文档",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#参考文档","aria-hidden":"true"},"#"),t(" 参考文档")],-1),Y={href:"https://docs.microsoft.com/zh-cn/aspnet/core/host-and-deploy/iis/?view=aspnetcore-5.0",target:"_blank",rel:"noopener noreferrer"};function $(D,F){const r=l("ExternalLinkIcon");return s(),i("div",null,[d,e("p",null,[t("Internet Information Services (IIS) 是一种灵活、安全且可管理的 Web 服务器，用于托管 Web 应用（包括 "),e("a",p,[t("ASP.NET"),o(r)]),t(" Core）。虽然我们的程序可以跨平台了，不过还是有些服务是部署在windows服务器下的，下面我们就从头开始部署下我们的程序到IIS.")]),h,g,_,m,u,e("h2",f,[b,t(),e("a",N,[t("安装ASP.NET"),o(r)]),t(" Core托管捆绑包")]),e("p",null,[t("安装的文件应该和项目对应的版本相同，现在我项目使用的.net版本是5，那么我应该也用5的，下载地址是："),e("a",k,[t("此处"),o(r)])]),e("p",null,[t("安装其他版本的请参考官网地址："),e("a",A,[t(".NET Core托管捆绑包"),o(r)])]),e("blockquote",null,[e("p",null,[t("捆绑包可安装 .NET Core 运行时、.NET Core 库和 "),e("a",S,[t("ASP.NET Core 模块"),o(r)]),t("。 该模块允许 "),e("a",v,[t("ASP.NET"),o(r)]),t(" Core 应用在 IIS 运行。")])]),w,e("blockquote",null,[e("p",null,[t("源码地址："),e("a",x,[t("https://gitee.com/AZRNG/my-example"),o(r)]),t(" 需要自取")])]),P,y,E,T,e("blockquote",null,[e("p",null,[t("为了正确设置 "),e("a",I,[t("ASP.NET"),o(r)]),t(" Core 模块，web.config 文件必须存在于已部署应用的根路径中。里面可以设置一些环境、日志等配置。")])]),z,C,e("blockquote",null,[e("p",null,[t("自 "),e("a",G,[t("ASP.NET"),o(r)]),t(" Core 3.0 起，默认情况下已为部署到 IIS 的所有应用启用进程内托管。")])]),e("p",null,[t("进程内托管在与其 IIS 工作进程相同的进程中运行 "),e("a",R,[t("ASP.NET"),o(r)]),t(" Core 应用。 进程内承载相较进程外承载提供更优的性能，因为请求并不通过环回适配器进行代理，环回适配器是一个网络接口，用于将传出的网络流量返回给同一计算机。")]),Z,e("blockquote",null,[e("p",null,[t("该图说明了 IIS、"),e("a",q,[t("ASP.NET"),o(r)]),t(" Core 模块和进程内托管的应用之间的关系")])]),W,e("p",null,[t("由于运行 "),e("a",M,[t("ASP.NET"),o(r)]),t(" Core 进程与 IIS 工作进程分开，"),e("a",H,[t("所以ASP.NET"),o(r)]),t(" Core 模块会负责进程管理。")]),L,e("blockquote",null,[e("p",null,[t("该图说明了 IIS、"),e("a",O,[t("ASP.NET"),o(r)]),t(" Core 模块和进程外托管的应用之间的关系")])]),V,e("p",null,[t("关于两种托管方式的差异："),e("a",B,[t("此处"),o(r)])]),j,e("p",null,[t("如果出现了错误可以查看点此处查看常见错误解决方案："),e("a",Q,[t("此处"),o(r)])]),e("p",null,[t("题外话：当初部署2.1版本时候，windows server 2012r2需要打好几个补丁，并且需要重启多次，没想到这次安装net5这么顺利(服务器是从朋友那借的，我自己的是linux)，"),e("a",K,[t("如果你所在公司需要部署.net"),o(r)]),t("，还是推荐linux进行部署。")]),X,e("blockquote",null,[e("p",null,[e("a",Y,[t("https://docs.microsoft.com/zh-cn/aspnet/core/host-and-deploy/iis/?view=aspnetcore-5.0"),o(r)])])])])}const U=a(c,[["render",$],["__file","iis.html.vue"]]);export{U as default};
