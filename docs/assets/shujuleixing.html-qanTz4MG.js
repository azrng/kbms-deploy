import{_ as p}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as o,o as c,c as l,a as n,d as s,e,b as t}from"./app-qB9_Bjjp.js";const i="/kbms/common/1622735518261-499fa3a9-679d-41cd-8032-a17dc2f7c0ac.png",u="/kbms/common/1622735885792-3554866c-5909-443e-8256-74b16161b794.png",r="/kbms/common/1622736068317-320f7e00-4b80-47ce-be3f-ee138b42bb88.png",d="/kbms/common/1622736318320-07d89ede-a729-4c86-8eb0-b418f6cabd45.png",k={},m=t('<h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><p>值类型和引用类型 值类型：struct、enum、int、float、char、bool、decimal 引用类型：class、delegate、interface、array、object、string</p><h3 id="值类型" tabindex="-1"><a class="header-anchor" href="#值类型"><span>值类型</span></a></h3><p>值类型包含大多数的内置类型(所有的数值类型、char类型和bool类型)以及自定义的struct类型和enum类型。值类型的变量或常量的内容仅仅是一个值。例如，内置的int类型的内容是32位的数据。值类型比引用类型更高效，因为它没有指针引用，不用分配在托管堆中，也不用被 GC 回收。</p><p>通过struct关键字定义自定义值类型 <img src="'+i+`" alt="image.png" loading="lazy"></p><blockquote><p>内存中值类型的实例</p></blockquote><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token class-name">Point</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> X<span class="token punctuation">,</span> Y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>值类型实例的赋值总是会进行实例的复制。</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code>    <span class="token class-name"><span class="token keyword">var</span></span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p1<span class="token punctuation">.</span>X <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> p2 <span class="token operator">=</span> p1<span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//7</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//7</span>
    p1<span class="token punctuation">.</span>X <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//9</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//7</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+u+'" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><blockquote><p>赋值操作复制了值类型的实例</p></blockquote><h3 id="引用类型" tabindex="-1"><a class="header-anchor" href="#引用类型"><span>引用类型</span></a></h3><p>引用类型包含所有的类、数组、委托、和接口类型(包括预定于的string类型)。</p><p>引用类型比值类型复杂，它包含：对象和对象的引用。引用类型变量或变量中的内容是一个包含值对象的引用(只是一个地址) <img src="'+r+`" alt="image.png" loading="lazy"></p><blockquote><p>内存汇总的引用类型实例</p></blockquote><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Point</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> X<span class="token punctuation">,</span> Y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>给引用类型变量赋值只会复制引用，而不是直接复制对象实例。如果重复之前的复制操作，那么对P1的修改操作就会影响到P2。</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code>    <span class="token class-name"><span class="token keyword">var</span></span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p1<span class="token punctuation">.</span>X <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> p2 <span class="token operator">=</span> p1<span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//7</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//7</span>
    p1<span class="token punctuation">.</span>X <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//9</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//9</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这是因为P1和P2指向同一个对象的两个不同的引用。 <img src="`+d+`" alt="image.png" loading="lazy"></p><blockquote><p>赋值操作复制了引用</p></blockquote><h3 id="泛型参数" tabindex="-1"><a class="header-anchor" href="#泛型参数"><span>泛型参数</span></a></h3><h3 id="指针类型" tabindex="-1"><a class="header-anchor" href="#指针类型"><span>指针类型</span></a></h3><h2 id="分配区域" tabindex="-1"><a class="header-anchor" href="#分配区域"><span>分配区域</span></a></h2><p>值类型一般都分配在栈上，引用类型存放在堆上，引用地址在栈上。 “值类型分配的时候都在栈上”， 这是一句错误的说法，如果是局部变量，那就在线程栈上，如果是类中字段，那就在托管堆上，如果是静态变量，那就是clr的高频堆上。</p><h2 id="类型转换" tabindex="-1"><a class="header-anchor" href="#类型转换"><span>类型转换</span></a></h2><h3 id="隐式转换" tabindex="-1"><a class="header-anchor" href="#隐式转换"><span>隐式转换</span></a></h3><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">int</span></span> myInt <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;int: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">myInt</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">decimal</span></span> myDecimal <span class="token operator">=</span> myInt<span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;decimal: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">myDecimal</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="显式转换" tabindex="-1"><a class="header-anchor" href="#显式转换"><span>显式转换</span></a></h3><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">string</span></span> str <span class="token operator">=</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> myInt <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">decimal</span></span> myDecimal <span class="token operator">=</span> <span class="token number">3.14m</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> myInt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>myDecimal<span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;int: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">myInt</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="转换的对比" tabindex="-1"><a class="header-anchor" href="#转换的对比"><span>转换的对比</span></a></h4><h5 id="int-parse" tabindex="-1"><a class="header-anchor" href="#int-parse"><span>int.Parse</span></a></h5><p>该方法在命名空间System的Int32结构体下，该方法接收一个字符串，返回一个int类型的值。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>int.Parse(&quot;&quot;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>先简单看下里面的写法</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>public static int Parse(string s)
{
  if (s == null)
	ThrowHelper.ThrowArgumentNullException(ExceptionArgument.s);
  return Number.ParseInt32((ReadOnlySpan&lt;char&gt;) s, NumberStyles.Integer, NumberFormatInfo.CurrentInfo);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从该方法可以看到如果传入的参数是null，直接就报错。接着进入ParseInt32方法，我们发现这里居然有调用了TryParseInt32，然后根据调用该方法的返回值判断，如果不是OK，那么就抛出异常ThrowOverflowOrFormatException。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>internal static int ParseInt32(ReadOnlySpan&lt;char&gt; value,NumberStyles styles,NumberFormatInfo info)
{
  int result;
  Number.ParsingStatus int32 = Number.TryParseInt32(value, styles, info, out result);
  if (int32 != Number.ParsingStatus.OK)
	Number.ThrowOverflowOrFormatException(int32, TypeCode.Int32);
  return result;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再往下的代码TryParseInt32里面又调用了<strong>Number.TryParseInt32IntegerStyle</strong>，虽然我没看懂，不过不影响这次的目的。</p><blockquote><p>总结：传入null时候，抛出异常ThrowArgumentNullException，传入转换失败的内容就抛出异常ThrowOverflowOrFormatException。转换成功就返回转换成功的值。</p></blockquote><h5 id="int-tryparse" tabindex="-1"><a class="header-anchor" href="#int-tryparse"><span>int.TryParse</span></a></h5><p>该方法也在命名空间System的Int32结构体下，该方法接收一个字符串以及一个输出参数，并且返回一个bool类型的值。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>var value = int.TryParse(str, out int result);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>首先和上面不同的是，这个方法的入参是一个可为null的string字符串</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>public static bool TryParse([NotNullWhen(true)] string? s, out int result)
{
  if (s != null)
	return Number.TryParseInt32IntegerStyle((ReadOnlySpan&lt;char&gt;) s, NumberStyles.Integer, NumberFormatInfo.CurrentInfo, out result) == Number.ParsingStatus.OK;
  result = 0;
  return false;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到如果参数传null，那么输出参数result就会赋值给0，至于为什么是0，是因为int类型的默认值就是0，如果是double.TryParse，那么默认值就是0.0，给一个默认的输出参数值后，返回了一个false，代表转换失败。具体的转换方法在于<strong>Number.TryParseInt32IntegerStyle</strong>。</p><blockquote><p>总结：传入null或者传入不能转换的值就返回false，并且输出参数为默认值。转换成功就返回true，并且输出参数返回转换后的值。</p></blockquote><h5 id="convert-toint32" tabindex="-1"><a class="header-anchor" href="#convert-toint32"><span>Convert.ToInt32</span></a></h5><p>该方法也在命名空间System的Convert类下，该方法接收一个可为null字符串，并且返回一个int类型的值。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>Convert.ToInt32(str);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>进入该方法我们可以看到,如果传入的参数为null，那么就返回默认值。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>public static int ToInt32(string? value)
{
	if (value == null)
		return 0;
	return int.Parse(value);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果入参不为null，那么就调用int.Parse(value)的转换。</p><h4 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h4><table><thead><tr><th></th><th>int.Parse</th><th>int.TryParse</th><th>Convert.ToInt32</th></tr></thead><tbody><tr><td>入参为null</td><td>抛出ThrowArgumentNullException</td><td>返回false，输出参数为默认值</td><td>返回默认值</td></tr><tr><td>转换失败</td><td>抛出ThrowOverflowOrFormatException</td><td>返回false，输出参数为默认值</td><td>抛出ThrowOverflowOrFormatException</td></tr><tr><td>转换成功</td><td>返回转换成功后的值</td><td>返回true，输出参数为成功的值</td><td>返回转换成功后的值</td></tr><tr><td>参数为浮点数</td><td>不支持</td><td>不支持</td><td>四舍五入取整，4.2返回4，4.6返回5</td></tr></tbody></table><h3 id="数据丢失" tabindex="-1"><a class="header-anchor" href="#数据丢失"><span>数据丢失</span></a></h3><p>类型之间进行转换遵从的原则是“扩大转换”，如果一个可以保留较少信息的数据类型转换为一种可保留较多信息的数据类型，这种情况下，不会丢失信息，反之可能会丢失信息。</p>`,56),v={href:"https://docs.microsoft.com/zh-cn/dotnet/standard/base-types/conversion-tables",target:"_blank",rel:"noopener noreferrer"},b=t(`<h2 id="装箱拆箱" tabindex="-1"><a class="header-anchor" href="#装箱拆箱"><span>装箱拆箱</span></a></h2><h3 id="装箱" tabindex="-1"><a class="header-anchor" href="#装箱"><span>装箱</span></a></h3><p><strong>装箱</strong>就是将一个值类型的数据存储在一个引用类型的变量中。 假设你一个方法中创建了一个 int 类型的本地变量，你要将这个值类型表示为一个引用类型，那么就表示你对这个值进行了装箱操作，如下所示：</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SimpleBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name"><span class="token keyword">int</span></span> myInt <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>

  <span class="token comment">// 装箱操作</span>
  <span class="token class-name"><span class="token keyword">object</span></span> boxedInt <span class="token operator">=</span> myInt<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>确切地说，装箱的过程就是将一个值类型分配给 Object 类型变量的过程。当你装箱一个值时，CoreCLR 会在堆上分配一个新的对象，并将该值类型的值复制到该对象实例。返回给你的是一个在托管堆中新分配的对象的引用。</p><h3 id="拆箱" tabindex="-1"><a class="header-anchor" href="#拆箱"><span>拆箱</span></a></h3><p>反过来，将 Object 引用类型变量的值转换回栈中相应的值类型的过程则称为<strong>拆箱</strong>。 从语法上讲，拆箱操作看起来就像一个正常的转换操作。然而，其语义是完全不同的。CoreCLR 首先验证接收的数据类型是否等同于被装箱的类型，如果是，它就把值复制回基于栈存储的本地变量中。 例如，如果下面的 boxedInt 的底层类型确实是 int，那就完成了拆箱操作：</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SimpleBoxUnbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name"><span class="token keyword">int</span></span> myInt <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>

  <span class="token comment">// 装箱操作</span>
  <span class="token class-name"><span class="token keyword">object</span></span> boxedInt <span class="token operator">=</span> myInt<span class="token punctuation">;</span>

  <span class="token comment">// 拆箱操作</span>
  <span class="token class-name"><span class="token keyword">int</span></span> unboxedInt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>boxedInt<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>记住，与执行典型的类型转换不同，你必须将其拆箱到一个恰当的数据类型中。如果你试图将一块数据拆箱到不正确的数据类型中，将会抛出 InvalidCastException 异常。为了安全起见，如果你不能保证 Object 类型背后的类型，最好使用 try/catch 逻辑把拆箱操作包起来，尽管这样会有些麻烦。考虑下面的代码，它将抛出一个错误，因为你正试图将装箱的 int 类型拆箱成一个 long 类型：</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SimpleBoxUnbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name"><span class="token keyword">int</span></span> myInt <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>

  <span class="token comment">// 装箱操作</span>
  <span class="token class-name"><span class="token keyword">object</span></span> boxedInt <span class="token operator">=</span> myInt<span class="token punctuation">;</span>

  <span class="token comment">// 拆箱到错误的数据类型，将触发运行时异常</span>
  <span class="token keyword">try</span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">long</span></span> unboxedLong <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>boxedInt<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvalidCastException</span> ex<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="总结-1" tabindex="-1"><a class="header-anchor" href="#总结-1"><span>总结</span></a></h3><p>对一个整型数进行装箱和拆箱所需要的步骤</p><ol><li>在托管堆中分配一个新对象；</li><li>在栈中的数据值被转移到该托管堆中的对象上；</li><li>当拆箱时，存储在堆中对象上的值被转移回栈中；</li><li>堆上未使用的对象将最终被 GC 回收。</li></ol><h2 id="正确实现浅拷贝和深拷贝" tabindex="-1"><a class="header-anchor" href="#正确实现浅拷贝和深拷贝"><span>正确实现浅拷贝和深拷贝</span></a></h2><p>对于值类型而言，copy就相当于是全盘复制了，真正的实现了复制，属于深拷贝；而对于引用类型而言，一般的copy只是浅拷贝，只是copy到了引用对象的地址，相当于值传递了一个引用指针，新的对象通过地址引用仍然指向原有内存中的对象。</p><p>浅拷贝：是指将对象中的数值类型的字段拷贝到新的对象中，而对象中的引用类型的字段则指复制它的一个引用到目标对象。如果改变目标对象中引用型字段的值在原始对象也会跟随者变化。 深拷贝：与浅拷贝的不同是对于引用的处理，深拷贝将会在内存中创建一个新的对象，对应字段和原始对象完全相同。也就是说这个引用和原始对象的引用地址是不相同的，所以我们在改变新对象中的这个字段的时候是不会影响到原始字段中对应字段的内容。</p><h3 id="浅拷贝" tabindex="-1"><a class="header-anchor" href="#浅拷贝"><span>浅拷贝</span></a></h3><p>将对象中的所有字段复制到新的对象（副本）中。其中，值类型字段的值被复制到副本中后，在副本中的修改不会影响到源对象对应的值。而引用类型的字段被复制到副本中的是引用类型的引用，而不是引用的对象，在副本中对引用类型的字段值做修改会影响到源对象本身。</p><p>一个简单的浅拷贝的实现代码如下所示： C#中System.Object 是所有类类型、结构类型、枚举类型和委托类型的基类，可以说它是类型继承的基础。System.Object包括一个用于拷贝当前对象实例的MemberwiseClone的方法。MemberwiseClone方法创建一个新对象的浅拷贝，并把当前对象实例的非静态字段拷贝至新对象实例中。通过属性，对象拷贝能够正确执行：如果属性是值类型，那么将拷贝数据，如果属性是引用类型，那么将拷贝原始对象的引用，也就是说，克隆对象指向同一个对象实例。这就意味着MemberwiseClone方法并未创建一个对象的深拷贝。</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CloneClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> IdCode <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Department</span> Department <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
    <span class="token doc-comment comment">/// 浅拷贝</span>
    <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
    <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span></span>
    <span class="token keyword">public</span> <span class="token return-type class-name">CloneClass</span> <span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>CloneClass<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">MemberwiseClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Department</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用示例</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> cloneClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CloneClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cloneClass<span class="token punctuation">.</span>IdCode <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">;</span>
cloneClass<span class="token punctuation">.</span>Department <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Department</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;血液肿瘤科&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> newCloneClass <span class="token operator">=</span> cloneClass<span class="token punctuation">.</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newCloneClass<span class="token punctuation">.</span>IdCode <span class="token operator">=</span> <span class="token string">&quot;newUser&quot;</span><span class="token punctuation">;</span>
newCloneClass<span class="token punctuation">.</span>Department<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;内科&quot;</span><span class="token punctuation">;</span>

<span class="token string">&quot;输出老的对象&quot;</span><span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cloneClass<span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token string">&quot;输出新的对象&quot;</span><span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newCloneClass<span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出效果</span>
<span class="token string">&quot;输出老的对象&quot;</span>
            CloneClass
┌────────────┬───────────────────┐
│ Name       │ Value             │
├────────────┼───────────────────┤
│ IdCode     │ <span class="token string">&quot;user&quot;</span>            │
│ Age        │ <span class="token number">0</span>                 │
│ Department │    Department     │
│            │ ┌──────┬────────┐ │
│            │ │ Name │ Value  │ │
│            │ ├──────┼────────┤ │
│            │ │ Name │ <span class="token string">&quot;内科&quot;</span> │ │
│            │ └──────┴────────┘ │
└────────────┴───────────────────┘

<span class="token string">&quot;输出新的对象&quot;</span>
            CloneClass
┌────────────┬───────────────────┐
│ Name       │ Value             │
├────────────┼───────────────────┤
│ IdCode     │ <span class="token string">&quot;newUser&quot;</span>         │
│ Age        │ <span class="token number">0</span>                 │
│ Department │    Department     │
│            │ ┌──────┬────────┐ │
│            │ │ Name │ Value  │ │
│            │ ├──────┼────────┤ │
│            │ │ Name │ <span class="token string">&quot;内科&quot;</span> │ │
│            │ └──────┴────────┘ │
└────────────┴───────────────────┘
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意到CloneClass的IdCode属性是string类型。理论上string类型是引用类型，但是由于该引用类型的特殊性（无论是实现还是语义），Object.MemberwiseClone方法仍旧为其创建了副本。也就是说，在浅拷贝过程，我们应该将字符串看成是值类型。</p><h3 id="深拷贝" tabindex="-1"><a class="header-anchor" href="#深拷贝"><span>深拷贝</span></a></h3><p>同样，将对象中的所有字段复制到新的对象中。不过，无论是对象的值类型字段，还是引用类型字段，都会被重新创建并赋值，对于副本的修改，不会影响到源对象本身。</p><p>深拷贝实现样例如下(建议使用序列化的形式来进行深拷贝,写法简单，但是性能稍差)</p><h4 id="binaryformatter" tabindex="-1"><a class="header-anchor" href="#binaryformatter"><span>BinaryFormatter</span></a></h4><blockquote><p>注意：BinaryFormatter方法已经被弃用了</p></blockquote><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Serializable</span></span><span class="token punctuation">]</span> <span class="token comment">// 二进制序列化需要添加</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Department</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Serializable</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeepCopyClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> IdCode <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Department</span> Department <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
    <span class="token doc-comment comment">/// 浅拷贝</span>
    <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
    <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span></span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DeepCopyClass</span> <span class="token function">DeepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> objectStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MemoryStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IFormatter</span> formatter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BinaryFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        formatter<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span>objectStream<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectStream<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>Begin<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> formatter<span class="token punctuation">.</span><span class="token function">Deserialize</span><span class="token punctuation">(</span>objectStream<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token class-name">DeepCopyClass</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用示例</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> cloneClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DeepCopyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cloneClass<span class="token punctuation">.</span>IdCode <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">;</span>
cloneClass<span class="token punctuation">.</span>Department <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Department</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;血液肿瘤科&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> newCloneClass <span class="token operator">=</span> cloneClass<span class="token punctuation">.</span><span class="token function">DeepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newCloneClass<span class="token punctuation">.</span>IdCode <span class="token operator">=</span> <span class="token string">&quot;newUser&quot;</span><span class="token punctuation">;</span>
newCloneClass<span class="token punctuation">.</span>Department<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;内科&quot;</span><span class="token punctuation">;</span>

<span class="token string">&quot;输出老的对象&quot;</span><span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cloneClass<span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token string">&quot;输出新的对象&quot;</span><span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newCloneClass<span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出结果</span>
<span class="token string">&quot;输出老的对象&quot;</span>
             DeepCopyClass
┌────────────┬─────────────────────────┐
│ Name       │ Value                   │
├────────────┼─────────────────────────┤
│ IdCode     │ <span class="token string">&quot;user&quot;</span>                  │
│ Age        │ <span class="token number">0</span>                       │
│ Department │       Department        │
│            │ ┌──────┬──────────────┐ │
│            │ │ Name │ Value        │ │
│            │ ├──────┼──────────────┤ │
│            │ │ Name │ <span class="token string">&quot;血液肿瘤科&quot;</span> │ │
│            │ └──────┴──────────────┘ │
└────────────┴─────────────────────────┘

<span class="token string">&quot;输出新的对象&quot;</span>
          DeepCopyClass
┌────────────┬───────────────────┐
│ Name       │ Value             │
├────────────┼───────────────────┤
│ IdCode     │ <span class="token string">&quot;newUser&quot;</span>         │
│ Age        │ <span class="token number">0</span>                 │
│ Department │    Department     │
│            │ ┌──────┬────────┐ │
│            │ │ Name │ Value  │ │
│            │ ├──────┼────────┤ │
│            │ │ Name │ <span class="token string">&quot;内科&quot;</span> │ │
│            │ └──────┴────────┘ │
└────────────┴───────────────────┘
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="systemtextjson序列化和反序列化" tabindex="-1"><a class="header-anchor" href="#systemtextjson序列化和反序列化"><span>SystemTextJson序列化和反序列化</span></a></h4><p>通过自带的Systen.Text.Json包的序列化和反序列化来实现深拷贝效果，扩展方式示例如下</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CloneExtensions</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">DeepCopy</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">T</span> obj<span class="token punctuation">)</span>
        <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> ms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MemoryStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonSerializerOptions</span>
        <span class="token punctuation">{</span>
            ReferenceHandler <span class="token operator">=</span> ReferenceHandler<span class="token punctuation">.</span>Preserve<span class="token punctuation">,</span>
            PropertyNamingPolicy <span class="token operator">=</span> JsonNamingPolicy<span class="token punctuation">.</span>CamelCase
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        JsonSerializer<span class="token punctuation">.</span><span class="token function">SerializeAsync</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ms<span class="token punctuation">.</span>Position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> JsonSerializer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Deserialize</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>操作示例</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> cloneClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DeepCopyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cloneClass<span class="token punctuation">.</span>IdCode <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">;</span>
cloneClass<span class="token punctuation">.</span>Department <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Department</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;血液肿瘤科&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> newCloneClass <span class="token operator">=</span> cloneClass<span class="token punctuation">.</span><span class="token function">DeepCopy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newCloneClass<span class="token punctuation">.</span>IdCode <span class="token operator">=</span> <span class="token string">&quot;newUser&quot;</span><span class="token punctuation">;</span>
newCloneClass<span class="token punctuation">.</span>Department<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;内科&quot;</span><span class="token punctuation">;</span>

<span class="token string">&quot;输出老的对象&quot;</span><span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cloneClass<span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token string">&quot;输出新的对象&quot;</span><span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newCloneClass<span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="newtonsoft序列化和反序列化" tabindex="-1"><a class="header-anchor" href="#newtonsoft序列化和反序列化"><span>Newtonsoft序列化和反序列化</span></a></h4><p>借助Newtonsoft.Json包来实现</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">Clone</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">T</span> obj<span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> JsonConvert<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">DeserializeObject</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参考文档" tabindex="-1"><a class="header-anchor" href="#参考文档"><span>参考文档</span></a></h2>`,40),g={href:"https://mp.weixin.qq.com/s/5wv8VGq16l8Bp9x4kMfOKA",target:"_blank",rel:"noopener noreferrer"};function h(y,w){const a=o("ExternalLinkIcon");return c(),l("div",null,[m,n("blockquote",null,[n("p",null,[s("如何判断是否是扩大转换，参考："),n("a",v,[s("https://docs.microsoft.com/zh-cn/dotnet/standard/base-types/conversion-tables"),e(a)])])]),b,n("blockquote",null,[n("p",null,[s("《C#核心技术指南》 "),n("a",g,[s("https://mp.weixin.qq.com/s/5wv8VGq16l8Bp9x4kMfOKA"),e(a)]),s(" | [019] C#基础：理解装箱与拆箱")])])])}const C=p(k,[["render",h],["__file","shujuleixing.html.vue"]]),q=JSON.parse('{"path":"/dotnet/csharp/duixiangheleixing/shujuleixing.html","title":"数据类型","lang":"zh-CN","frontmatter":{"title":"数据类型","lang":"zh-CN","date":"2023-10-22T00:00:00.000Z","publish":true,"author":"azrng","isOriginal":true,"category":["csharp"],"tag":["无"],"filename":"shujuleixing","slug":"lgayke","docsId":"46546440","description":"概述 值类型和引用类型 值类型：struct、enum、int、float、char、bool、decimal 引用类型：class、delegate、interface、array、object、string 值类型 值类型包含大多数的内置类型(所有的数值类型、char类型和bool类型)以及自定义的struct类型和enum类型。值类型的变量或常量...","head":[["meta",{"property":"og:url","content":"https://azrng.gitee.io/kbms/kbms/dotnet/csharp/duixiangheleixing/shujuleixing.html"}],["meta",{"property":"og:site_name","content":"知识库"}],["meta",{"property":"og:title","content":"数据类型"}],["meta",{"property":"og:description","content":"概述 值类型和引用类型 值类型：struct、enum、int、float、char、bool、decimal 引用类型：class、delegate、interface、array、object、string 值类型 值类型包含大多数的内置类型(所有的数值类型、char类型和bool类型)以及自定义的struct类型和enum类型。值类型的变量或常量..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://azrng.gitee.io/kbms/kbms/common/1622735518261-499fa3a9-679d-41cd-8032-a17dc2f7c0ac.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-11-17T14:50:44.000Z"}],["meta",{"property":"article:author","content":"azrng"}],["meta",{"property":"article:tag","content":"无"}],["meta",{"property":"article:published_time","content":"2023-10-22T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-11-17T14:50:44.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"数据类型\\",\\"image\\":[\\"https://azrng.gitee.io/kbms/kbms/common/1622735518261-499fa3a9-679d-41cd-8032-a17dc2f7c0ac.png\\",\\"https://azrng.gitee.io/kbms/kbms/common/1622735885792-3554866c-5909-443e-8256-74b16161b794.png\\",\\"https://azrng.gitee.io/kbms/kbms/common/1622736068317-320f7e00-4b80-47ce-be3f-ee138b42bb88.png\\",\\"https://azrng.gitee.io/kbms/kbms/common/1622736318320-07d89ede-a729-4c86-8eb0-b418f6cabd45.png\\"],\\"datePublished\\":\\"2023-10-22T00:00:00.000Z\\",\\"dateModified\\":\\"2023-11-17T14:50:44.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"azrng\\"}]}"]]},"headers":[{"level":2,"title":"概述","slug":"概述","link":"#概述","children":[{"level":3,"title":"值类型","slug":"值类型","link":"#值类型","children":[]},{"level":3,"title":"引用类型","slug":"引用类型","link":"#引用类型","children":[]},{"level":3,"title":"泛型参数","slug":"泛型参数","link":"#泛型参数","children":[]},{"level":3,"title":"指针类型","slug":"指针类型","link":"#指针类型","children":[]}]},{"level":2,"title":"分配区域","slug":"分配区域","link":"#分配区域","children":[]},{"level":2,"title":"类型转换","slug":"类型转换","link":"#类型转换","children":[{"level":3,"title":"隐式转换","slug":"隐式转换","link":"#隐式转换","children":[]},{"level":3,"title":"显式转换","slug":"显式转换","link":"#显式转换","children":[{"level":4,"title":"转换的对比","slug":"转换的对比","link":"#转换的对比","children":[{"level":5,"title":"int.Parse","slug":"int-parse","link":"#int-parse","children":[]},{"level":5,"title":"int.TryParse","slug":"int-tryparse","link":"#int-tryparse","children":[]},{"level":5,"title":"Convert.ToInt32","slug":"convert-toint32","link":"#convert-toint32","children":[]}]},{"level":4,"title":"总结","slug":"总结","link":"#总结","children":[]}]},{"level":3,"title":"数据丢失","slug":"数据丢失","link":"#数据丢失","children":[]}]},{"level":2,"title":"装箱拆箱","slug":"装箱拆箱","link":"#装箱拆箱","children":[{"level":3,"title":"装箱","slug":"装箱","link":"#装箱","children":[]},{"level":3,"title":"拆箱","slug":"拆箱","link":"#拆箱","children":[]},{"level":3,"title":"总结","slug":"总结-1","link":"#总结-1","children":[]}]},{"level":2,"title":"正确实现浅拷贝和深拷贝","slug":"正确实现浅拷贝和深拷贝","link":"#正确实现浅拷贝和深拷贝","children":[{"level":3,"title":"浅拷贝","slug":"浅拷贝","link":"#浅拷贝","children":[]},{"level":3,"title":"深拷贝","slug":"深拷贝","link":"#深拷贝","children":[{"level":4,"title":"BinaryFormatter","slug":"binaryformatter","link":"#binaryformatter","children":[]},{"level":4,"title":"SystemTextJson序列化和反序列化","slug":"systemtextjson序列化和反序列化","link":"#systemtextjson序列化和反序列化","children":[]},{"level":4,"title":"Newtonsoft序列化和反序列化","slug":"newtonsoft序列化和反序列化","link":"#newtonsoft序列化和反序列化","children":[]}]}]},{"level":2,"title":"参考文档","slug":"参考文档","link":"#参考文档","children":[]}],"git":{"createdTime":1700232644000,"updatedTime":1700232644000,"contributors":[{"name":"azrng","email":"itzhangyunpeng@163.com","commits":1}]},"readingTime":{"minutes":11.2,"words":3360},"filePathRelative":"dotnet/csharp/duixiangheleixing/shujuleixing.md","localizedDate":"2023年10月22日","excerpt":"<h2>概述</h2>\\n<p>值类型和引用类型\\n值类型：struct、enum、int、float、char、bool、decimal\\n引用类型：class、delegate、interface、array、object、string</p>\\n<h3>值类型</h3>\\n<p>值类型包含大多数的内置类型(所有的数值类型、char类型和bool类型)以及自定义的struct类型和enum类型。值类型的变量或常量的内容仅仅是一个值。例如，内置的int类型的内容是32位的数据。值类型比引用类型更高效，因为它没有指针引用，不用分配在托管堆中，也不用被 GC 回收。</p>\\n<p>通过struct关键字定义自定义值类型\\n<img src=\\"/common/1622735518261-499fa3a9-679d-41cd-8032-a17dc2f7c0ac.png\\" alt=\\"image.png\\" loading=\\"lazy\\"></p>","autoDesc":true}');export{C as comp,q as data};
