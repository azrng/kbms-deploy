import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as t,d as e,o as a}from"./app-BQsqMNmR.js";const n={};function l(h,i){return a(),t("div",null,i[0]||(i[0]=[e(`<h2 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍"><span>介绍</span></a></h2><p>是一个API，支持用户登录界面等功能，可以管理用户、密码、配置文件数据、角色等。</p><h2 id="要解决的问题" tabindex="-1"><a class="header-anchor" href="#要解决的问题"><span>要解决的问题</span></a></h2><p>以下就是我针对此次任务给你提出来的需求。<br><strong>身份系统</strong></p><ul><li><a href="http://xn--ASP-vs9dj4u9ey29gezg0qck85doz4b.NET" target="_blank" rel="noopener noreferrer">可以同时被所有的ASP.NET</a> 框架使用（Web MVC，Web Forms，Web Api，SignalR）</li><li>可以应用于构建 Web, 手机，存储，或者混合应用。</li></ul><p><strong>能够对用户资料（User Profile）很方便的扩展</strong></p><ul><li>可以针对用户资料进行扩展。</li></ul><p><strong>持久化</strong></p><ul><li>默认把用户信息存储在数据库中，可以支持使用EF进行持久化。（<strong>可以看到，EF 其实只是Identity的一个功能点而已</strong>）</li><li>可以控制数据库架构，更改表名或者主键的数据类型（int，string）</li><li>可以使用不同的存储机制（如 NoSQL，DB2等）</li></ul><p><strong>单元测试</strong></p><ul><li>使WEB 应用程序可以进行单元测试，<a href="http://xn--ASP-vs9dj4u3on1p0h.NET" target="_blank" rel="noopener noreferrer">可以针对ASP.NET</a> Identity编写单元测试</li></ul><p><strong>角色机制</strong></p><ul><li>提供角色机制，可以使用不同的角色来进行不同权限的限制，可以轻松的创建角色，向用户添加角色等。</li></ul><p><strong>要支持基于Claims</strong></p><ul><li>需要支持基于 Claims 的身份验证机制，其中用户身份是一组Claims，一组Claims可以比角色拥有更强的表现力，而角色仅仅是一个bool值来表示是不是会员而已。</li></ul><p><strong>第三方社交登陆</strong></p><ul><li>可以很方便的使用第三方登入，比如 Microsoft 账户，Facebook， Twitter，Google等，并且存储用户特定的数据。</li></ul><p><strong>封装为中间件</strong></p><ul><li>基于中间件实现，不要对具体项目产生依赖</li><li>基于 Authorzation 中间件实现，而不是使用 FormsAuthentication 来存储cookie。</li></ul><p><strong>NuGet包提供</strong></p><ul><li>发布为 Nuget 包，这样可以容易的进行迭代和bug修复，可以灵活的提供给使用者。</li></ul><p>以上，就是我提出来的需求，如果让你来封装这样一个用户身份认证组件，你是不是想到以上的这些功能点。</p><blockquote><p>参考资料：<a href="https://www.cnblogs.com/savorboard/p/aspnetcore-identity3.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/savorboard/p/aspnetcore-identity3.html</a></p></blockquote><h2 id="操作" tabindex="-1"><a class="header-anchor" href="#操作"><span>操作</span></a></h2><p>引用组件</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">ItemGroup</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">	&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PackageReference</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> Include</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;AzrngCommon&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> Version</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1.2.6&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">	&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">PackageReference</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> Include</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Microsoft.EntityFrameworkCore.Tools&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> Version</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;6.0.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">		&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">PrivateAssets</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">all</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">PrivateAssets</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">		&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">IncludeAssets</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">runtime</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">build</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">native</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">contentfiles</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">analyzers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">buildtransitive</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">IncludeAssets</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">	&lt;/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">PackageReference</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">	&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PackageReference</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> Include</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Pomelo.EntityFrameworkCore.MySql&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> Version</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;6.0.0&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">	&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">PackageReference</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> Include</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Swashbuckle.AspNetCore&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> Version</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;6.2.3&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">	&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">PackageReference</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> Include</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Microsoft.EntityFrameworkCore.Relational&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> Version</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;6.0.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">	&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">PackageReference</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> Include</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Microsoft.EntityFrameworkCore.Design&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> Version</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;6.0.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">		&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">PrivateAssets</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">all</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">PrivateAssets</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">		&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">IncludeAssets</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">runtime</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">build</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">native</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">contentfiles</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">analyzers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">buildtransitive</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">IncludeAssets</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">	&lt;/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">PackageReference</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">	&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PackageReference</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> Include</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Microsoft.AspNetCore.Identity.EntityFrameworkCore&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> Version</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;6.0.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">ItemGroup</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="数据库表" tabindex="-1"><a class="header-anchor" href="#数据库表"><span>数据库表</span></a></h3><p>重点放在包Microsoft.AspNetCore.Identity.EntityFrameworkCore<br> 该包默认生成的数据库表为：</p><ul><li>AspNetUsers：用户表</li><li>AspNetUserClaims：用户Claim(单个信息项)表</li><li>AspNetUserLogins：用户登录信息表</li><li>AspNetUserTokens：用户token信息表</li><li>AspNetRoles：角色表</li><li>AspNetRoleClaims：角色Claim(单个信息项)表</li><li>AspNetUserRoles：用户角色关系表</li></ul><h3 id="代码" tabindex="-1"><a class="header-anchor" href="#代码"><span>代码</span></a></h3><p>三个对象<br><strong>SignInManager</strong>： 主要处理注册登录相关业务逻辑。<br><strong>UserManager</strong>： 处理用户相关添加删除，修改密码，添加删除角色等。<br><strong>RoleManager</strong>：角色相关添加删除更新等。<br> 有些同学可能很好奇，都没有依赖具体的数据库或者是EF，是怎么样做到的增删改查的呢？<br> 这个时候，就需要几个 Store 接口派上用场了。以下是Identity中定义的Store接口：</p><ul><li>IQueryableRoleStore</li><li>IQueryableUserStore</li><li>IRoleClaimStore</li><li>IRoleStore</li><li>IUserAuthenticationTokenStore</li><li>IUserClaimStore</li><li>IUserEmailStore</li><li>IUserLockoutStore</li><li>IUserLoginStore</li><li>IUserPasswordStore</li><li>IUserPhoneNumberStore</li><li>IUserRoleStore</li><li>IUserSecurityStampStore</li><li>IUserStore</li><li>IUserTwoFactorStore</li></ul><h2 id="参考文档" tabindex="-1"><a class="header-anchor" href="#参考文档"><span>参考文档</span></a></h2><p>介绍：<a href="https://docs.microsoft.com/zh-cn/aspnet/core/security/authentication/identity?view=aspnetcore-5.0&amp;tabs=visual-studio" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn/aspnet/core/security/authentication/identity?view=aspnetcore-5.0&amp;tabs=visual-studio</a><br> 配置Identity：<a href="https://docs.microsoft.com/zh-cn/aspnet/core/security/authentication/identity-configuration?view=aspnetcore-6.0" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn/aspnet/core/security/authentication/identity-configuration?view=aspnetcore-6.0</a><br> 源码地址：<a href="https://github.com/dotnet/aspnetcore/tree/v6.0.1/src/Identity" target="_blank" rel="noopener noreferrer">https://github.com/dotnet/aspnetcore/tree/v6.0.1/src/Identity</a><br> 系列文章：<a href="https://mp.weixin.qq.com/s/mh5mB1v9HXzgqhnX1vNYsw" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/mh5mB1v9HXzgqhnX1vNYsw</a></p>`,34)]))}const k=s(n,[["render",l],["__file","jieshao.html.vue"]]),o=JSON.parse('{"path":"/dotnet/anquanhebiaoshi/shenfenrenzhengheshouquan/identity/jieshao.html","title":"介绍","lang":"zh-CN","frontmatter":{"title":"介绍","lang":"zh-CN","date":"2023-04-02T00:00:00.000Z","publish":true,"author":"azrng","isOriginal":true,"category":["dotNET"],"tag":["无"],"filename":"jieshao","slug":"vy51it","docsId":"45180777","description":"介绍 是一个API，支持用户登录界面等功能，可以管理用户、密码、配置文件数据、角色等。 要解决的问题 以下就是我针对此次任务给你提出来的需求。 身份系统 可以同时被所有的ASP.NET 框架使用（Web MVC，Web Forms，Web Api，SignalR） 可以应用于构建 Web, 手机，存储，或者混合应用。 能够对用户资料（User Prof...","head":[["meta",{"property":"og:url","content":"https://azrng.gitee.io/kbms/kbms/dotnet/anquanhebiaoshi/shenfenrenzhengheshouquan/identity/jieshao.html"}],["meta",{"property":"og:site_name","content":"知识库"}],["meta",{"property":"og:title","content":"介绍"}],["meta",{"property":"og:description","content":"介绍 是一个API，支持用户登录界面等功能，可以管理用户、密码、配置文件数据、角色等。 要解决的问题 以下就是我针对此次任务给你提出来的需求。 身份系统 可以同时被所有的ASP.NET 框架使用（Web MVC，Web Forms，Web Api，SignalR） 可以应用于构建 Web, 手机，存储，或者混合应用。 能够对用户资料（User Prof..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-10-22T08:11:43.000Z"}],["meta",{"property":"article:author","content":"azrng"}],["meta",{"property":"article:tag","content":"无"}],["meta",{"property":"article:published_time","content":"2023-04-02T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-10-22T08:11:43.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"介绍\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-04-02T00:00:00.000Z\\",\\"dateModified\\":\\"2023-10-22T08:11:43.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"azrng\\"}]}"]]},"headers":[{"level":2,"title":"介绍","slug":"介绍","link":"#介绍","children":[]},{"level":2,"title":"要解决的问题","slug":"要解决的问题","link":"#要解决的问题","children":[]},{"level":2,"title":"操作","slug":"操作","link":"#操作","children":[{"level":3,"title":"数据库表","slug":"数据库表","link":"#数据库表","children":[]},{"level":3,"title":"代码","slug":"代码","link":"#代码","children":[]}]},{"level":2,"title":"参考文档","slug":"参考文档","link":"#参考文档","children":[]}],"git":{"createdTime":1697962303000,"updatedTime":1697962303000,"contributors":[{"name":"azrng","username":"azrng","email":"itzhangyunpeng@163.com","commits":1}]},"readingTime":{"minutes":2.97,"words":891},"filePathRelative":"dotnet/anquanhebiaoshi/shenfenrenzhengheshouquan/identity/jieshao.md","localizedDate":"2023年4月2日","excerpt":"<h2>介绍</h2>\\n<p>是一个API，支持用户登录界面等功能，可以管理用户、密码、配置文件数据、角色等。</p>\\n<h2>要解决的问题</h2>\\n<p>以下就是我针对此次任务给你提出来的需求。<br>\\n<strong>身份系统</strong></p>\\n<ul>\\n<li><a href=\\"http://xn--ASP-vs9dj4u9ey29gezg0qck85doz4b.NET\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">可以同时被所有的ASP.NET</a> 框架使用（Web MVC，Web Forms，Web Api，SignalR）</li>\\n<li>可以应用于构建 Web, 手机，存储，或者混合应用。</li>\\n</ul>","autoDesc":true}');export{k as comp,o as data};
