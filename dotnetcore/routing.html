<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://azrng.github.io/kbms/kbms/dotnetcore/routing.html"><meta property="og:site_name" content="çŸ¥è¯†åº“"><meta property="og:title" content="è·¯ç”±"><meta property="og:description" content="Routingï¼ˆè·¯ç”±ï¼‰ï¼šæ›´å‡†ç¡®çš„åº”è¯¥å«åšEndpoint Routingï¼Œè´Ÿè´£å°†HTTPè¯·æ±‚æŒ‰ç…§åŒ¹é…è§„åˆ™é€‰æ‹©å¯¹åº”çš„ç»ˆç»“ç‚¹; Endpointï¼ˆç»ˆç»“ç‚¹ï¼‰ï¼šè´Ÿè´£å½“HTTPè¯·æ±‚åˆ°è¾¾æ—¶ï¼Œæ‰§è¡Œä»£ç ; è·¯ç”±æ˜¯é€šè¿‡UseRoutingå’Œ`UseEndpointsä¸¤ä¸ªä¸­é—´ä»¶é…åˆåœ¨ä¸€èµ·æ¥å®Œæˆæ³¨å†Œçš„ï¼š UseRoutingï¼šç”¨äºå‘ä¸­é—´ä»¶ç®¡é“æ·»åŠ è·¯ç”±åŒ¹é…ä¸­é—´ä»¶ï¼ˆEndpoi..."><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-12-09T02:19:17.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="azrng"><meta property="article:tag" content="route"><meta property="article:published_time" content="2022-08-25T00:00:00.000Z"><meta property="article:modified_time" content="2022-12-09T02:19:17.000Z"><title>è·¯ç”± | çŸ¥è¯†åº“</title><meta name="description" content="Routingï¼ˆè·¯ç”±ï¼‰ï¼šæ›´å‡†ç¡®çš„åº”è¯¥å«åšEndpoint Routingï¼Œè´Ÿè´£å°†HTTPè¯·æ±‚æŒ‰ç…§åŒ¹é…è§„åˆ™é€‰æ‹©å¯¹åº”çš„ç»ˆç»“ç‚¹; Endpointï¼ˆç»ˆç»“ç‚¹ï¼‰ï¼šè´Ÿè´£å½“HTTPè¯·æ±‚åˆ°è¾¾æ—¶ï¼Œæ‰§è¡Œä»£ç ; è·¯ç”±æ˜¯é€šè¿‡UseRoutingå’Œ`UseEndpointsä¸¤ä¸ªä¸­é—´ä»¶é…åˆåœ¨ä¸€èµ·æ¥å®Œæˆæ³¨å†Œçš„ï¼š UseRoutingï¼šç”¨äºå‘ä¸­é—´ä»¶ç®¡é“æ·»åŠ è·¯ç”±åŒ¹é…ä¸­é—´ä»¶ï¼ˆEndpoi...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/kbms/assets/style.ff819d8f.css" as="style" /><link rel="stylesheet" href="/kbms/assets/style.ff819d8f.css" />
    <link rel="modulepreload" href="/kbms/assets/app.2bd5222d.js"><link rel="modulepreload" href="/kbms/assets/framework.35562d63.js"><link rel="modulepreload" href="/kbms/assets/routing.html.3553c12e.js"><link rel="modulepreload" href="/kbms/assets/routing.html.63a29fc4.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/kbms/" class="brand"><img class="logo" src="/kbms/logo.svg" alt="çŸ¥è¯†åº“"><!----><span class="site-name hide-in-pad">çŸ¥è¯†åº“</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/kbms/" class="nav-link" aria-label="é¦–é¡µ"><span class="icon iconfont icon-home"></span>é¦–é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a href="/kbms/web/introduce.html" class="nav-link" aria-label="Web"><!---->Web<!----></a></div><div class="nav-item hide-in-mobile"><a href="/kbms/csharp/predefined-type.html" class="nav-link" aria-label="csharp"><!---->csharp<!----></a></div><div class="nav-item hide-in-mobile"><a href="/kbms/dotnetcore/base.html" class="nav-link" aria-label="dotnetcore"><!---->dotnetcore<!----></a></div><div class="nav-item hide-in-mobile"><a href="/kbms/middleware/yapi.html" class="nav-link" aria-label="ä¸­é—´ä»¶"><!---->ä¸­é—´ä»¶<!----></a></div><div class="nav-item hide-in-mobile"><a href="/kbms/db/base.html" class="nav-link" aria-label="æ•°æ®åº“"><!---->æ•°æ®åº“<!----></a></div><div class="nav-item hide-in-mobile"><a href="/kbms/soft/soft-collection.html" class="nav-link" aria-label="è½¯ä»¶"><!---->è½¯ä»¶<!----></a></div><div class="nav-item hide-in-mobile"><a href="/kbms/interview/anti-fraud.html" class="nav-link" aria-label="é¢è¯•"><!---->é¢è¯•<!----></a></div><div class="nav-item hide-in-mobile"><a href="/kbms/aboutme/aboutme.html" class="nav-link" aria-label="ä¸ªäººä»‹ç»"><!---->ä¸ªäººä»‹ç»<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><p class="sidebar-heading active"><!----><span class="title">åŸºç¡€çŸ¥è¯†</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/base.html" class="nav-link sidebar-link sidebar-page" aria-label="ä»‹ç»"><!---->ä»‹ç»<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/globalization.html" class="nav-link sidebar-link sidebar-page" aria-label="å¤šè¯­è¨€é…ç½®"><!---->å¤šè¯­è¨€é…ç½®<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/kbms/dotnetcore/routing.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="è·¯ç”±"><!---->è·¯ç”±<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/kbms/dotnetcore/routing.html#è·å–ç»ˆç»“ç‚¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è·å–ç»ˆç»“ç‚¹"><!---->è·å–ç»ˆç»“ç‚¹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kbms/dotnetcore/routing.html#é…ç½®ç»ˆç»“ç‚¹å§”æ‰˜" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é…ç½®ç»ˆç»“ç‚¹å§”æ‰˜"><!---->é…ç½®ç»ˆç»“ç‚¹å§”æ‰˜<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kbms/dotnetcore/routing.html#è·¯ç”±æ¨¡æ¿" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è·¯ç”±æ¨¡æ¿"><!---->è·¯ç”±æ¨¡æ¿<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/kbms/dotnetcore/routing.html#catch-allå‚æ•°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="catch-allå‚æ•°"><!---->catch-allå‚æ•°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kbms/dotnetcore/routing.html#å¤æ‚æ®µ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¤æ‚æ®µ"><!---->å¤æ‚æ®µ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kbms/dotnetcore/routing.html#è·¯ç”±çº¦æŸ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è·¯ç”±çº¦æŸ"><!---->è·¯ç”±çº¦æŸ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/kbms/dotnetcore/routing.html#è‡ªå®šä¹‰è·¯ç”±çº¦æŸ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è‡ªå®šä¹‰è·¯ç”±çº¦æŸ"><!---->è‡ªå®šä¹‰è·¯ç”±çº¦æŸ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kbms/dotnetcore/routing.html#è·¯ç”±æ¨¡æ¿ä¼˜å…ˆçº§" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è·¯ç”±æ¨¡æ¿ä¼˜å…ˆçº§"><!---->è·¯ç”±æ¨¡æ¿ä¼˜å…ˆçº§<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kbms/dotnetcore/routing.html#userouting" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="UseRouting"><!---->UseRouting<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/kbms/dotnetcore/routing.html#endpointroutingmiddleware" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="EndpointRoutingMiddleware"><!---->EndpointRoutingMiddleware<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kbms/dotnetcore/routing.html#endpointmiddleware" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="EndpointMiddleware"><!---->EndpointMiddleware<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/healthcheck.html" class="nav-link sidebar-link sidebar-page" aria-label="å¥åº·æ£€æŸ¥"><!---->å¥åº·æ£€æŸ¥<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">é…ç½®æ¡†æ¶</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/config/configread.html" class="nav-link sidebar-link sidebar-page" aria-label="é…ç½®è¯»å–"><!---->é…ç½®è¯»å–<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">è·¨åŸŸ</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/kuayu.html" class="nav-link sidebar-link sidebar-page" aria-label="è·¨åŸŸ"><!---->è·¨åŸŸ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">é™æ€èµ„æº</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/staticfile/base.html" class="nav-link sidebar-link sidebar-page" aria-label="é™æ€èµ„æº-åŸºæœ¬è®¾ç½®"><!---->é™æ€èµ„æº-åŸºæœ¬è®¾ç½®<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/staticfile/customerconfig.html" class="nav-link sidebar-link sidebar-page" aria-label="é™æ€èµ„æº-è‡ªå®šä¹‰è®¾ç½®"><!---->é™æ€èµ„æº-è‡ªå®šä¹‰è®¾ç½®<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">æ—¥å¿—</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/loggers/ilogger.html" class="nav-link sidebar-link sidebar-page" aria-label="Logger"><!---->Logger<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/loggers/serilog.html" class="nav-link sidebar-link sidebar-page" aria-label="Serilog"><!---->Serilog<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/loggers/nlog.html" class="nav-link sidebar-link sidebar-page" aria-label="NLog"><!---->NLog<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/loggers/log4net.html" class="nav-link sidebar-link sidebar-page" aria-label="Log4net"><!---->Log4net<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/loggers/logdashboard.html" class="nav-link sidebar-link sidebar-page" aria-label="LogDashboard"><!---->LogDashboard<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">è¿‡æ»¤å™¨</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/filter/base.html" class="nav-link sidebar-link sidebar-page" aria-label="è¿‡æ»¤å™¨åŸºæœ¬ä½¿ç”¨"><!---->è¿‡æ»¤å™¨åŸºæœ¬ä½¿ç”¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/filter/realize.html" class="nav-link sidebar-link sidebar-page" aria-label="è¿‡æ»¤å™¨å¸¸è§æ“ä½œ"><!---->è¿‡æ»¤å™¨å¸¸è§æ“ä½œ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">OpenApi</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/openapi/swaggerbase.html" class="nav-link sidebar-link sidebar-page" aria-label="swagger-åŸºç¡€ä½¿ç”¨"><!---->swagger-åŸºç¡€ä½¿ç”¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/openapi/version.html" class="nav-link sidebar-link sidebar-page" aria-label="swagger-ç‰ˆæœ¬æ§åˆ¶"><!---->swagger-ç‰ˆæœ¬æ§åˆ¶<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">èº«ä»½è®¤è¯å’Œæˆæƒ</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/auth/session.html" class="nav-link sidebar-link sidebar-page" aria-label="Session"><!---->Session<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/auth/cookie.html" class="nav-link sidebar-link sidebar-page" aria-label="Cookie"><!---->Cookie<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/auth/jwt_baseuse.html" class="nav-link sidebar-link sidebar-page" aria-label="Jwtä½¿ç”¨"><!---->Jwtä½¿ç”¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">å¥åº·æ£€æŸ¥</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/healthcheck.html" class="nav-link sidebar-link sidebar-page" aria-label="å¥åº·æ£€æŸ¥"><!---->å¥åº·æ£€æŸ¥<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">å®æ—¶é€šä¿¡</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/real-time/base.html" class="nav-link sidebar-link sidebar-page" aria-label="å®æ—¶é€šä¿¡-æŠ€æœ¯å¤§ä¹±æ–—"><!---->å®æ—¶é€šä¿¡-æŠ€æœ¯å¤§ä¹±æ–—<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">ç¼“å­˜</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/cache/memorycache.html" class="nav-link sidebar-link sidebar-page" aria-label="MemoryCache"><!---->MemoryCache<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/cache/redis.html" class="nav-link sidebar-link sidebar-page" aria-label="åˆ†å¸ƒå¼ç¼“å­˜"><!---->åˆ†å¸ƒå¼ç¼“å­˜<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">èº«ä»½è®¤è¯å’Œæˆæƒ</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/auth/session.html" class="nav-link sidebar-link sidebar-page" aria-label="Session"><!---->Session<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">IOC</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/ioc/base.html" class="nav-link sidebar-link sidebar-page" aria-label="æ§åˆ¶åè½¬"><!---->æ§åˆ¶åè½¬<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/DI/default.html" class="nav-link sidebar-link sidebar-page" aria-label="é»˜è®¤ä¾èµ–æ³¨å…¥"><!---->é»˜è®¤ä¾èµ–æ³¨å…¥<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">WebAPI</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/webapi/webapi-base.html" class="nav-link sidebar-link sidebar-page" aria-label="WebApiè°ƒç”¨ç¤ºä¾‹"><!---->WebApiè°ƒç”¨ç¤ºä¾‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/webapi/webapiversion.html" class="nav-link sidebar-link sidebar-page" aria-label="APIç‰ˆæœ¬æ§åˆ¶"><!---->APIç‰ˆæœ¬æ§åˆ¶<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">æ“ä½œæ•°æ®åº“</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/orm/createdb.html" class="nav-link sidebar-link sidebar-page" aria-label="EFCore-ç”Ÿæˆæ•°æ®åº“"><!---->EFCore-ç”Ÿæˆæ•°æ®åº“<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/orm/efcoreoperation.html" class="nav-link sidebar-link sidebar-page" aria-label="EFCore-å¢åˆ æ”¹æŸ¥"><!---->EFCore-å¢åˆ æ”¹æŸ¥<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">å•å…ƒæµ‹è¯•</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/unit-test/base.html" class="nav-link sidebar-link sidebar-page" aria-label="åŸºç¡€ä»‹ç»"><!---->åŸºç¡€ä»‹ç»<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/unit-test/base-use-dissent.html" class="nav-link sidebar-link sidebar-page" aria-label="ç®€å•ä½¿ç”¨-äº‰è®®ç¯‡"><!---->ç®€å•ä½¿ç”¨-äº‰è®®ç¯‡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/unit-test/base-use.html" class="nav-link sidebar-link sidebar-page" aria-label="å•å…ƒæµ‹è¯•ç®€å•ä½¿ç”¨"><!---->å•å…ƒæµ‹è¯•ç®€å•ä½¿ç”¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">WinForm</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/winform/use_di.html" class="nav-link sidebar-link sidebar-page" aria-label="WinFormä½¿ç”¨ä¾èµ–æ³¨å…¥"><!---->WinFormä½¿ç”¨ä¾èµ–æ³¨å…¥<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">å°çŸ¥è¯†</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/small/dynamic_load.html" class="nav-link sidebar-link sidebar-page" aria-label="ç®€å•åŠ¨æ€åŠ è½½ç¤ºä¾‹"><!---->ç®€å•åŠ¨æ€åŠ è½½ç¤ºä¾‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">éƒ¨ç½²</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/kbms/dotnetcore/release/iis.html" class="nav-link sidebar-link sidebar-page" aria-label="IISéƒ¨ç½²DotNet5"><!---->IISéƒ¨ç½²DotNet5<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/release/centos_net6.html" class="nav-link sidebar-link sidebar-page" aria-label="Centos7éƒ¨ç½²å’Œå®ˆæŠ¤è¿›ç¨‹"><!---->Centos7éƒ¨ç½²å’Œå®ˆæŠ¤è¿›ç¨‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/release/supervisor.html" class="nav-link sidebar-link sidebar-page" aria-label="éƒ¨ç½²ä¹‹SupervisoråŸºç¡€"><!---->éƒ¨ç½²ä¹‹SupervisoråŸºç¡€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/kbms/dotnetcore/release/docker.html" class="nav-link sidebar-link sidebar-page" aria-label="Dockeréƒ¨ç½²è¯¦ç»†æµç¨‹"><!---->Dockeréƒ¨ç½²è¯¦ç»†æµç¨‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->è·¯ç”±</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="author-item">azrng</span></span><span property="author" content="azrng"></span></span><span class="origin">åŸåˆ›</span><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-08-25T00:00:00.000Z"></span><span class="category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li><span class="category category8 clickable" role="navigation">dotNet</span></li></ul><meta property="articleSection" content="dotNet"></span><span aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li><span class="tag tag3 clickable" role="navigation">route</span></li></ul><meta property="keywords" content="route"></span><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 13 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT13M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/kbms/dotnetcore/routing.html#è·å–ç»ˆç»“ç‚¹" class="router-link-active router-link-exact-active toc-link level2">è·å–ç»ˆç»“ç‚¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kbms/dotnetcore/routing.html#é…ç½®ç»ˆç»“ç‚¹å§”æ‰˜" class="router-link-active router-link-exact-active toc-link level2">é…ç½®ç»ˆç»“ç‚¹å§”æ‰˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kbms/dotnetcore/routing.html#è·¯ç”±æ¨¡æ¿" class="router-link-active router-link-exact-active toc-link level2">è·¯ç”±æ¨¡æ¿</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/kbms/dotnetcore/routing.html#catch-allå‚æ•°" class="router-link-active router-link-exact-active toc-link level3">catch-allå‚æ•°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kbms/dotnetcore/routing.html#å¤æ‚æ®µ" class="router-link-active router-link-exact-active toc-link level3">å¤æ‚æ®µ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kbms/dotnetcore/routing.html#è·¯ç”±çº¦æŸ" class="router-link-active router-link-exact-active toc-link level2">è·¯ç”±çº¦æŸ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/kbms/dotnetcore/routing.html#è‡ªå®šä¹‰è·¯ç”±çº¦æŸ" class="router-link-active router-link-exact-active toc-link level3">è‡ªå®šä¹‰è·¯ç”±çº¦æŸ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kbms/dotnetcore/routing.html#è·¯ç”±æ¨¡æ¿ä¼˜å…ˆçº§" class="router-link-active router-link-exact-active toc-link level2">è·¯ç”±æ¨¡æ¿ä¼˜å…ˆçº§</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kbms/dotnetcore/routing.html#userouting" class="router-link-active router-link-exact-active toc-link level2">UseRouting</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/kbms/dotnetcore/routing.html#endpointroutingmiddleware" class="router-link-active router-link-exact-active toc-link level3">EndpointRoutingMiddleware</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kbms/dotnetcore/routing.html#endpointmiddleware" class="router-link-active router-link-exact-active toc-link level3">EndpointMiddleware</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="routing" tabindex="-1"><a class="header-anchor" href="#routing" aria-hidden="true">#</a> Routing</h1><ul><li>Routingï¼ˆè·¯ç”±ï¼‰ï¼šæ›´å‡†ç¡®çš„åº”è¯¥å«åšEndpoint Routingï¼Œè´Ÿè´£å°†HTTPè¯·æ±‚æŒ‰ç…§åŒ¹é…è§„åˆ™é€‰æ‹©å¯¹åº”çš„ç»ˆç»“ç‚¹</li><li>Endpointï¼ˆç»ˆç»“ç‚¹ï¼‰ï¼šè´Ÿè´£å½“HTTPè¯·æ±‚åˆ°è¾¾æ—¶ï¼Œæ‰§è¡Œä»£ç </li></ul><p>è·¯ç”±æ˜¯é€šè¿‡<code>UseRouting</code>å’Œ<code>UseEndpoints</code>ä¸¤ä¸ªä¸­é—´ä»¶é…åˆåœ¨ä¸€èµ·æ¥å®Œæˆæ³¨å†Œçš„ï¼š</p><div class="language-c# line-numbers-mode" data-ext="c#"><pre class="language-c#"><code>public class Startup
{
    public void ConfigureServices(IServiceCollection services)
    {
        // æ·»åŠ Routingç›¸å…³æœåŠ¡
        // æ³¨æ„ï¼Œå…¶å·²åœ¨ ConfigureWebDefaults ä¸­æ·»åŠ ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ ï¼Œæ­¤å¤„ä»…ä¸ºæ¼”ç¤º
        services.AddRouting();
    }
    
    public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
    {
        app.UseRouting();
    
        app.UseEndpoints(endpoints =&gt;
        {
            endpoints.MapGet(&quot;/&quot;, async context =&gt;
            {
                await context.Response.WriteAsync(&quot;Hello World!&quot;);
            });
        });
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>UseRouting</code>ï¼šç”¨äºå‘ä¸­é—´ä»¶ç®¡é“æ·»åŠ è·¯ç”±åŒ¹é…ä¸­é—´ä»¶ï¼ˆ<code>EndpointRoutingMiddleware</code>ï¼‰ã€‚è¯¥ä¸­é—´ä»¶ä¼šæ£€æŸ¥åº”ç”¨ä¸­å®šä¹‰çš„ç»ˆç»“ç‚¹åˆ—è¡¨ï¼Œç„¶åé€šè¿‡åŒ¹é… URL å’Œ HTTP æ–¹æ³•æ¥é€‰æ‹©æœ€ä½³çš„ç»ˆç»“ç‚¹ã€‚<strong>ç®€å•è¯´ï¼Œè¯¥ä¸­é—´ä»¶çš„ä½œç”¨æ˜¯æ ¹æ®ä¸€å®šè§„åˆ™æ¥é€‰æ‹©å‡ºç»ˆç»“ç‚¹</strong></li><li><code>UseEndpoints</code>ï¼šç”¨äºå‘ä¸­é—´ä»¶ç®¡é“æ·»åŠ ç»ˆç»“ç‚¹ä¸­é—´ä»¶ï¼ˆ<code>EndpointMiddleware</code>ï¼‰ã€‚å¯ä»¥å‘è¯¥ä¸­é—´ä»¶çš„ç»ˆç»“ç‚¹åˆ—è¡¨ä¸­æ·»åŠ ç»ˆç»“ç‚¹ï¼Œå¹¶é…ç½®è¿™äº›ç»ˆç»“ç‚¹è¦æ‰§è¡Œçš„å§”æ‰˜ï¼Œè¯¥ä¸­é—´ä»¶ä¼šè´Ÿè´£è¿è¡Œç”±<code>EndpointRoutingMiddleware</code>ä¸­é—´ä»¶é€‰æ‹©çš„ç»ˆç»“ç‚¹æ‰€å…³è”çš„å§”æ‰˜ã€‚<strong>ç®€å•è¯´ï¼Œè¯¥ä¸­é—´ä»¶ç”¨æ¥æ‰§è¡Œæ‰€é€‰æ‹©çš„ç»ˆç»“ç‚¹å§”æ‰˜</strong></li></ul><blockquote><p>UseRouting<code>ä¸</code>UseEndpoints<code>å¿…é¡»åŒæ—¶ä½¿ç”¨ï¼Œè€Œä¸”å¿…é¡»å…ˆè°ƒç”¨</code>UseRouting<code>ï¼Œå†è°ƒç”¨</code>UseEndpoints</p></blockquote><h1 id="endpoints" tabindex="-1"><a class="header-anchor" href="#endpoints" aria-hidden="true">#</a> Endpoints</h1><p>å…ˆäº†è§£ä¸€ä¸‹ç»ˆç»“ç‚¹çš„ç±»ç»“æ„ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public class Endpoint
{
    public Endpoint(RequestDelegate requestDelegate, EndpointMetadataCollection? metadata, string? displayName);

    public string? DisplayName { get; }

    public EndpointMetadataCollection Metadata { get; }

    public RequestDelegate RequestDelegate { get; }

    public override string? ToString();
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»ˆç»“ç‚¹æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>å¯æ‰§è¡Œï¼šå«æœ‰<code>RequestDelegate</code>å§”æ‰˜</li><li>å¯æ‰©å±•ï¼šå«æœ‰<code>Metadata</code>å…ƒæ•°æ®é›†åˆ</li><li>å¯é€‰æ‹©ï¼šå¯é€‰çš„åŒ…å«è·¯ç”±ä¿¡æ¯</li><li>å¯æšä¸¾ï¼šé€šè¿‡DIå®¹å™¨ï¼ŒæŸ¥æ‰¾<code>EndpointDataSource</code>æ¥å±•ç¤ºç»ˆç»“ç‚¹é›†åˆã€‚</li></ul><h2 id="è·å–ç»ˆç»“ç‚¹" tabindex="-1"><a class="header-anchor" href="#è·å–ç»ˆç»“ç‚¹" aria-hidden="true">#</a> è·å–ç»ˆç»“ç‚¹</h2><p>å¯¹äºä¸­é—´ä»¶è¿˜ä¸ç†Ÿæ‚‰çš„ï¼Œå¯ä»¥å…ˆçœ‹ä¸€ä¸‹ä¸­é—´ä»¶(Middleware)ã€‚</p><p>åœ¨ä¸­é—´ä»¶ç®¡é“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>HttpContext</code>æ¥æ£€ç´¢ç»ˆç»“ç‚¹ç­‰ä¿¡æ¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»ˆç»“ç‚¹å¯¹è±¡åœ¨åˆ›å»ºå®Œæ¯•åï¼Œæ˜¯ä¸å¯å˜çš„ï¼Œæ— æ³•ä¿®æ”¹ã€‚</p><blockquote><ul><li>åœ¨è°ƒç”¨<code>UseRouting</code>ä¹‹å‰ï¼Œä½ å¯ä»¥æ³¨å†Œä¸€äº›ç”¨äºä¿®æ”¹è·¯ç”±æ“ä½œçš„æ•°æ®ï¼Œæ¯”å¦‚<code>UseRewriter</code>ã€<code>UseHttpMethodOverride</code>ã€<code>UsePathBase</code>ç­‰ã€‚</li><li>åœ¨è°ƒç”¨<code>UseRouting</code>å’Œ<code>UseEndpoints</code>ä¹‹é—´ï¼Œå¯ä»¥æ³¨å†Œä¸€äº›ç”¨äºæå‰å¤„ç†è·¯ç”±ç»“æœçš„ä¸­é—´ä»¶ï¼Œå¦‚<code>UseAuthentication</code>ã€<code>UseAuthorization</code>ã€<code>UseCors</code>ç­‰ã€‚</li></ul></blockquote><p>æˆ‘ä»¬ä¸€èµ·çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    app.Use(next =&gt; context =&gt;
    {
        // åœ¨ UseRouting è°ƒç”¨å‰ï¼Œå§‹ç»ˆä¸º null
        Console.WriteLine($&quot;1. Endpoint: {context.GetEndpoint()?.DisplayName ?? &quot;null&quot;}&quot;);
        return next(context);
    });

    // EndpointRoutingMiddleware è°ƒç”¨ SetEndpoint æ¥è®¾ç½®ç»ˆç»“ç‚¹
    app.UseRouting();

    app.Use(next =&gt; context =&gt;
    {
        // å¦‚æœè·¯ç”±åŒ¹é…åˆ°äº†ç»ˆç»“ç‚¹ï¼Œé‚£ä¹ˆæ­¤å¤„å°±ä¸ä¸º nullï¼Œå¦åˆ™ï¼Œè¿˜æ˜¯ null
        Console.WriteLine($&quot;2. Endpoint: {context.GetEndpoint()?.DisplayName ?? &quot;null&quot;}&quot;);
        return next(context);
    });

    // EndpointMiddleware é€šè¿‡ GetEndpoint æ–¹æ³•è·å–ç»ˆç»“ç‚¹ï¼Œ
    // ç„¶åæ‰§è¡Œè¯¥ç»ˆç»“ç‚¹çš„ RequestDelegate å§”æ‰˜
    app.UseEndpoints(endpoints =&gt;
    {
        endpoints.MapGet(&quot;/&quot;, context =&gt;
        {
            // åŒ¹é…åˆ°äº†ç»ˆç»“ç‚¹ï¼Œè‚¯å®šä¸æ˜¯ null
            Console.WriteLine($&quot;3. Endpoint: {context.GetEndpoint()?.DisplayName ?? &quot;null&quot;}&quot;);
            return Task.CompletedTask;
        }).WithDisplayName(&quot;Custom Display Name&quot;);  // è‡ªå®šä¹‰ç»ˆç»“ç‚¹åç§°
    });

    app.Use(next =&gt; context =&gt;
    {
        // åªæœ‰å½“è·¯ç”±æ²¡æœ‰åŒ¹é…åˆ°ç»ˆç»“ç‚¹æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œè¿™é‡Œ
        Console.WriteLine($&quot;4. Endpoint: {context.GetEndpoint()?.DisplayName ?? &quot;null&quot;}&quot;);
        return next(context);
    });
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“è®¿é—®<code>/</code>æ—¶ï¼Œè¾“å‡ºä¸ºï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>1. Endpoint: null
2. Endpoint: Custom Display Name
3. Endpoint: Custom Display Name
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“è®¿é—®å…¶ä»–ä¸åŒ¹é…çš„URLæ—¶ï¼Œè¾“å‡ºä¸ºï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>1. Endpoint: null
2. Endpoint: null
4. Endpoint: null
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“è·¯ç”±åŒ¹é…åˆ°äº†ç»ˆç»“ç‚¹æ—¶ï¼Œ<code>EndpointMiddleware</code>åˆ™æ˜¯è¯¥è·¯ç”±çš„ç»ˆç«¯ä¸­é—´ä»¶ï¼›å½“æœªåŒ¹é…åˆ°ç»ˆç»“ç‚¹æ—¶ï¼Œä¼šç»§ç»­æ‰§è¡Œåé¢çš„ä¸­é—´ä»¶ã€‚</p><blockquote><p>ç»ˆç«¯ä¸­é—´ä»¶ï¼šä¸æ™®é€šä¸­é—´ä»¶ä¸åŒçš„æ˜¯ï¼Œè¯¥ä¸­é—´ä»¶æ‰§è¡Œåå³è¿”å›ï¼Œä¸ä¼šè°ƒç”¨åé¢çš„ä¸­é—´ä»¶ã€‚</p></blockquote><h2 id="é…ç½®ç»ˆç»“ç‚¹å§”æ‰˜" tabindex="-1"><a class="header-anchor" href="#é…ç½®ç»ˆç»“ç‚¹å§”æ‰˜" aria-hidden="true">#</a> é…ç½®ç»ˆç»“ç‚¹å§”æ‰˜</h2><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•å°†å§”æ‰˜å…³è”åˆ°ç»ˆç»“ç‚¹</p><ul><li>MapGet</li><li>MapPost</li><li>MapPut</li><li>MapDelete</li><li>MapHealthChecks</li><li>å…¶ä»–ç±»ä¼¼â€œMapXXXâ€çš„æ–¹æ³•</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    app.UseRouting();

    // åœ¨æ‰§è¡Œç»ˆç»“ç‚¹å‰è¿›è¡Œæˆæƒ
    app.UseAuthorization();

    app.UseEndpoints(endpoints =&gt;
    {
        endpoints.MapGet(&quot;/&quot;, async context =&gt; await context.Response.WriteAsync(&quot;get&quot;));
        endpoints.MapPost(&quot;/&quot;, async context =&gt; await context.Response.WriteAsync(&quot;post&quot;));
        endpoints.MapPut(&quot;/&quot;, async context =&gt; await context.Response.WriteAsync(&quot;put&quot;));
        endpoints.MapDelete(&quot;/&quot;, async context =&gt; await context.Response.WriteAsync(&quot;delete&quot;));
        endpoints.MapHealthChecks(&quot;/healthChecks&quot;);
        endpoints.MapControllers();
    });

}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="è·¯ç”±æ¨¡æ¿" tabindex="-1"><a class="header-anchor" href="#è·¯ç”±æ¨¡æ¿" aria-hidden="true">#</a> è·¯ç”±æ¨¡æ¿</h2><p>è§„åˆ™ï¼š</p><p name="">é€šè¿‡<code>{}</code>æ¥ç»‘å®šè·¯ç”±å‚æ•°ï¼Œå¦‚:</p><p name?="">å°†<code>?</code>ä½œä¸ºå‚æ•°åç¼€ï¼Œä»¥æŒ‡ç¤ºè¯¥å‚æ•°æ˜¯å¯é€‰çš„ï¼Œå¦‚ï¼š</p><p>é€šè¿‡<code>=</code>è®¾ç½®é»˜è®¤å€¼ï¼Œå¦‚ï¼š{name=jjj} è¡¨ç¤ºnameçš„é»˜è®¤å€¼æ˜¯jjj</p><p id:int:min(1)="">é€šè¿‡<code>:</code>æ·»åŠ å†…è”çº¦æŸï¼Œå¦‚ï¼š{id:int}ï¼Œåé¢è¿½åŠ <code>:</code>å¯ä»¥æ·»åŠ å¤šä¸ªå†…è”çº¦æŸï¼Œå¦‚ï¼š</p><p>å¤šä¸ªè·¯ç”±å‚æ•°é—´å¿…é¡»é€šè¿‡æ–‡æœ¬æˆ–åˆ†éš”ç¬¦åˆ†éš”ï¼Œä¾‹å¦‚ {a}{b} å°±ä¸ç¬¦åˆè§„åˆ™ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºç±»ä¼¼ {a}+-{b} æˆ– {a}/{b} çš„å½¢å¼</p><p>å…ˆä¸¾ä¸ªä¾‹å­ï¼Œ/book/{name}ä¸­çš„{name}ä¸ºè·¯ç”±å‚æ•°ï¼Œbook</p><p>ä¸ºéè·¯ç”±å‚æ•°æ–‡æœ¬ã€‚éè·¯ç”±å‚æ•°çš„æ–‡æœ¬å’Œåˆ†éš”ç¬¦/ï¼š</p><ul><li>æ˜¯ä¸åˆ†åŒºå¤§å°å†™çš„ï¼ˆå®˜æ–¹ä¸­æ–‡æ–‡æ¡£ç¿»è¯‘é”™äº†ï¼‰</li><li>è¦ä½¿ç”¨æ²¡æœ‰è¢«Urlç¼–ç çš„æ ¼å¼ï¼Œå¦‚ç©ºæ ¼ä¼šè¢«ç¼–ç ä¸º %20ï¼Œä¸åº”ä½¿ç”¨ %20ï¼Œè€Œåº”ä½¿ç”¨ç©ºæ ¼</li><li>å¦‚æœè¦åŒ¹é…<code>{</code>æˆ–<code>}</code>ï¼Œåˆ™ä½¿ç”¨<code>{{</code>æˆ–<code>}}</code>è¿›è¡Œè½¬ä¹‰</li></ul><h3 id="catch-allå‚æ•°" tabindex="-1"><a class="header-anchor" href="#catch-allå‚æ•°" aria-hidden="true">#</a> catch-allå‚æ•°</h3><p>è·¯ç”±æ¨¡æ¿ä¸­çš„æ˜Ÿå·<code>*</code>å’ŒåŒæ˜Ÿå·<code>**</code>è¢«ç§°ä¸ºcatch-allå‚æ•°ï¼Œè¯¥å‚æ•°å¯ä»¥ä½œä¸ºè·¯ç”±å‚æ•°çš„å‰ç¼€ï¼Œå¦‚<code>/Book/{*id}</code>ã€<code>/Book/{**id}</code>ï¼Œå¯ä»¥åŒ¹é…ä»¥<code>/Book</code>å¼€å¤´çš„ä»»æ„Urlï¼Œå¦‚<code>/Book</code>ã€<code>/Book/</code>ã€<code>/Book/abc</code>ã€<code>/Book/abc/def</code>ç­‰ã€‚</p><p><code>*</code>å’Œ<code>**</code>åœ¨ä¸€èˆ¬ä½¿ç”¨ä¸Šæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå®ƒä»¬ä»…ä»…åœ¨ä½¿ç”¨<code>LinkGenerator</code>æ—¶ä¼šæœ‰ä¸åŒï¼Œå¦‚<code>id = abc/def</code>ï¼Œå½“ä½¿ç”¨<code>/Book/{*id}</code>æ¨¡æ¿æ—¶ï¼Œä¼šç”Ÿæˆ<code>/Book/abc%2Fdef</code>ï¼Œå½“ä½¿ç”¨<code>/Book/{**id}</code>æ¨¡æ¿æ—¶ï¼Œä¼šç”Ÿæˆ<code>/Book/abc/def</code>ã€‚</p><h3 id="å¤æ‚æ®µ" tabindex="-1"><a class="header-anchor" href="#å¤æ‚æ®µ" aria-hidden="true">#</a> å¤æ‚æ®µ</h3><p>å¤æ‚æ®µé€šè¿‡<strong>éè´ªå©ª</strong>çš„æ–¹å¼<strong>ä»å³åˆ°å·¦</strong>è¿›è¡ŒåŒ¹é…ï¼Œä¾‹å¦‚<code>[Route(&quot;/a{b}c{d}&quot;)]</code>å°±æ˜¯ä¸€ä¸ªå¤æ‚æ®µã€‚å®é™…ä¸Šï¼Œå®ƒçš„ç¡®å¾ˆå¤æ‚ï¼Œåªæœ‰äº†è§£å®ƒçš„å·¥ä½œæ–¹å¼ï¼Œæ‰èƒ½æ­£ç¡®çš„ä½¿ç”¨å®ƒã€‚</p><blockquote><ul><li>è´ªå©ªåŒ¹é…ï¼ˆä¹Ÿç§°ä¸ºâ€œæ‡’æƒ°åŒ¹é…â€ï¼‰ï¼šåŒ¹é…æœ€å¤§å¯èƒ½çš„å­—ç¬¦ä¸²</li><li>éè´ªå©ªåŒ¹é…ï¼šåŒ¹é…æœ€å°å¯èƒ½çš„å­—ç¬¦ä¸²</li></ul></blockquote><p>æ¥ä¸‹æ¥ï¼Œå°±æ‹¿æ¨¡æ¿<code>[Route(&quot;/a{b}c{d}&quot;)]</code>æ¥ä¸¾ä¸¤ä¸ªä¾‹å­ï¼š</p><p><strong>æˆåŠŸåŒ¹é…</strong>çš„æ¡ˆä¾‹â€”â€”å½“Urlä¸º<code>/abcd</code>æ—¶ï¼ŒåŒ¹é…è¿‡ç¨‹ä¸ºï¼ˆ<code>|</code>ç”¨äºè¾…åŠ©å±•ç¤ºç®—æ³•çš„è§£ææ–¹å¼ï¼‰ï¼š</p><ul><li>ä»å³åˆ°å·¦è¯»å–æ¨¡æ¿ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ–‡æœ¬ä¸º<code>c</code>ã€‚æ¥ç€ï¼Œè¯»å–Url<code>/abcd</code>ï¼Œå¯è§£æä¸º<code>/ab|c|d</code></li><li>æ­¤æ—¶ï¼ŒUrlä¸­å³ä¾§çš„æ‰€æœ‰å†…å®¹<code>d</code>å‡ä¸è·¯ç”±å‚æ•°<code>{d}</code>åŒ¹é…</li><li>ç„¶åï¼Œç»§ç»­ä»å³åˆ°å·¦è¯»å–æ¨¡æ¿ï¼Œæ‰¾åˆ°çš„ä¸‹ä¸€ä¸ªæ–‡æœ¬ä¸º<code>a</code>ã€‚æ¥ç€ï¼Œä»åˆšæ‰åœä¸‹çš„åœ°æ–¹ç»§ç»­è¯»å–Url<code>/ab|c|d</code>ï¼Œè§£æä¸º<code>/a|b|c|d</code></li><li>æ­¤æ—¶ï¼ŒUrlä¸­å³ä¾§çš„å€¼<code>b</code>ä¸è·¯ç”±å‚æ•°<code>{b}</code>åŒ¹é…</li><li>æœ€åï¼Œæ²¡æœ‰å‰©ä½™çš„è·¯ç”±æ¨¡æ¿æ®µæˆ–å‚æ•°ï¼Œä¹Ÿæ²¡æœ‰å‰©ä½™çš„Urlæ–‡æœ¬ï¼Œå› æ­¤åŒ¹é…æˆåŠŸã€‚</li></ul><p><strong>åŒ¹é…å¤±è´¥</strong>çš„æ¡ˆä¾‹â€”â€”å½“Urlä¸º<code>/aabcd</code>æ—¶ï¼ŒåŒ¹é…è¿‡ç¨‹ä¸ºï¼ˆ<code>|</code>ç”¨äºè¾…åŠ©å±•ç¤ºç®—æ³•çš„è§£ææ–¹å¼ï¼‰ï¼š</p><ul><li>ä»å³åˆ°å·¦è¯»å–æ¨¡æ¿ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ–‡æœ¬ä¸º<code>c</code>ã€‚æ¥ç€ï¼Œè¯»å–Url<code>/aabcd</code>ï¼Œå¯è§£æä¸º<code>/aab|c|d</code></li><li>æ­¤æ—¶ï¼ŒUrlä¸­å³ä¾§çš„æ‰€æœ‰å†…å®¹<code>d</code>å‡ä¸è·¯ç”±å‚æ•°<code>{d}</code>åŒ¹é…</li><li>ç„¶åï¼Œç»§ç»­ä»å³åˆ°å·¦è¯»å–æ¨¡æ¿ï¼Œæ‰¾åˆ°çš„ä¸‹ä¸€ä¸ªæ–‡æœ¬ä¸º<code>a</code>ã€‚æ¥ç€ï¼Œä»åˆšæ‰åœä¸‹çš„åœ°æ–¹ç»§ç»­è¯»å–Url<code>/aab|c|d</code>ï¼Œè§£æä¸º<code>/a|a|b|c|d</code></li><li>æ­¤æ—¶ï¼ŒUrlä¸­å³ä¾§çš„å€¼<code>b</code>ä¸è·¯ç”±å‚æ•°<code>{b}</code>åŒ¹é…</li><li>æœ€åï¼Œæ²¡æœ‰å‰©ä½™çš„è·¯ç”±æ¨¡æ¿æ®µæˆ–å‚æ•°ï¼Œä½†è¿˜æœ‰å‰©ä½™çš„Urlæ–‡æœ¬ï¼Œå› æ­¤åŒ¹é…ä¸æˆåŠŸã€‚</li></ul><blockquote><p>ä½¿ç”¨å¤æ‚æ®µï¼Œç›¸æ¯”æ™®é€šè·¯ç”±æ¨¡æ¿æ¥è¯´ï¼Œä¼šé€ æˆæ›´åŠ æ˜‚è´µçš„æ€§èƒ½å½±å“</p></blockquote><h2 id="è·¯ç”±çº¦æŸ" tabindex="-1"><a class="header-anchor" href="#è·¯ç”±çº¦æŸ" aria-hidden="true">#</a> è·¯ç”±çº¦æŸ</h2><p>é€šè¿‡è·¯ç”±çº¦æŸï¼Œå¯ä»¥åœ¨è·¯ç”±åŒ¹é…è¿‡ç¨‹ä¸­ï¼Œæ£€æŸ¥URLæ˜¯å¦æ˜¯å¯æ¥å—çš„ã€‚å¦å¤–ï¼Œè·¯ç”±çº¦æŸä¸€èˆ¬æ˜¯ç”¨æ¥æ¶ˆé™¤è·¯ç”±æ­§ä¹‰ï¼Œè€Œä¸æ˜¯ç”¨æ¥è¿›è¡Œè¾“å…¥éªŒè¯çš„ã€‚</p><p>å®ç°ä¸Šï¼Œå½“Httpè¯·æ±‚åˆ°è¾¾æ—¶ï¼Œè·¯ç”±å‚æ•°å’Œè¯¥å‚æ•°çš„çº¦æŸåä¼šä¼ é€’ç»™<code>IInlineConstraintResolver</code>æœåŠ¡ï¼Œ<code>IInlineConstraintResolver</code>æœåŠ¡ä¼šè´Ÿè´£åˆ›å»º<code>IRouteConstraint</code>å®ä¾‹ï¼Œä»¥é’ˆå¯¹Urlè¿›è¡Œå¤„ç†ã€‚</p><p><strong>é¢„å®šä¹‰çš„è·¯****ç”±çº¦æŸ</strong></p><blockquote><p>æ‘˜è‡ªå®˜æ–¹æ–‡æ¡£</p></blockquote><p><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/7fxWIIIo4Qs3k4FurMojaRNCW3fBdEmIVxhrKuf2a2hiasj6QnurH65VvLQJMhicDq25cATsM9dTHeDticZxd5fbw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡" loading="lazy"></p><h4 id="æ­£åˆ™è¡¨è¾¾å¼è·¯ç”±çº¦æŸ" tabindex="-1"><a class="header-anchor" href="#æ­£åˆ™è¡¨è¾¾å¼è·¯ç”±çº¦æŸ" aria-hidden="true">#</a> æ­£åˆ™è¡¨è¾¾å¼è·¯ç”±çº¦æŸ</h4><p>é€šè¿‡<code>regex(expression)</code>æ¥è®¾ç½®æ­£åˆ™è¡¨è¾¾å¼çº¦æŸï¼Œå¹¶ä¸”è¯¥æ­£åˆ™è¡¨è¾¾å¼æ˜¯ï¼š</p><ul><li><code>RegexOptions.IgnoreCase</code>ï¼šå¿½ç•¥å¤§å°å†™</li><li><code>RegexOptions.Compiled</code>ï¼šå°†è¯¥æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘ä¸ºç¨‹åºé›†ã€‚è¿™ä¼šä½¿å¾—æ‰§è¡Œé€Ÿåº¦æ›´å¿«ï¼Œä½†ä¼šæ‹–æ…¢å¯åŠ¨æ—¶é—´ã€‚</li><li><code>RegexOptions.CultureInvariant</code>ï¼šå¿½ç•¥åŒºåŸŸæ–‡åŒ–å·®å¼‚ã€‚</li></ul><p>å¦å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„å¯¹æŸäº›å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼š</p><ul><li><code>\</code>æ›¿æ¢ä¸º<code>\\</code></li><li><code>{</code>æ›¿æ¢ä¸º<code>{{</code>ï¼Œ <code>}</code>æ›¿æ¢ä¸º<code>}}</code></li><li><code>[</code>æ›¿æ¢ä¸º<code>[[</code>ï¼Œ<code>]</code>æ›¿æ¢ä¸º<code>]]</code></li></ul><p>ä¾‹å¦‚ï¼š</p><p><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/7fxWIIIo4Qs3k4FurMojaRNCW3fBdEmIMfxNWluXowgF3nLwlpGJVrFWrFhvGToZhVBJywraOzXeuT76OBwBxw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡" loading="lazy"></p><ul><li>æŒ‡å®š regex çº¦æŸçš„ä¸¤ç§æ–¹å¼ï¼š</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// å†…è”æ–¹å¼
app.UseEndpoints(endpoints =&gt;
{
    endpoints.MapGet(&quot;{message:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}&quot;,
        context =&gt; 
        {
            return context.Response.WriteAsync(&quot;inline-constraint match&quot;);
        });
 });
 
// å˜é‡å£°æ˜æ–¹å¼
app.UseEndpoints(endpoints =&gt;
{
    endpoints.MapControllerRoute(
        name: &quot;people&quot;,
        pattern: &quot;People/{ssn}&quot;,
        constraints: new { ssn = &quot;^\\d{3}-\\d{2}-\\d{4}$&quot;, },
        defaults: new { controller = &quot;People&quot;, action = &quot;List&quot;, });
}); 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ä¸è¦ä¹¦å†™è¿‡äºå¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦åˆ™ï¼Œç›¸æ¯”æ™®é€šè·¯ç”±æ¨¡æ¿æ¥è¯´ï¼Œä¼šé€ æˆæ›´åŠ æ˜‚è´µçš„æ€§èƒ½å½±å“</p></blockquote><h3 id="è‡ªå®šä¹‰è·¯ç”±çº¦æŸ" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰è·¯ç”±çº¦æŸ" aria-hidden="true">#</a> è‡ªå®šä¹‰è·¯ç”±çº¦æŸ</h3><p>å…ˆè¯´ä¸€å¥ï¼Œè‡ªå®šä¹‰è·¯ç”±çº¦æŸå¾ˆå°‘ä¼šç”¨åˆ°ï¼Œåœ¨ä½ å†³å®šè¦è‡ªå®šä¹‰è·¯ç”±çº¦æŸä¹‹å‰ï¼Œå…ˆæƒ³æƒ³æ˜¯å¦æœ‰å…¶ä»–æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå¦‚ä½¿ç”¨æ¨¡å‹ç»‘å®šã€‚</p><p>é€šè¿‡å®ç°<code>IRouteConstraint</code>æ¥å£æ¥åˆ›å»ºè‡ªå®šä¹‰è·¯ç”±çº¦æŸï¼Œè¯¥æ¥å£ä»…æœ‰ä¸€ä¸ª<code>Match</code>æ–¹æ³•ï¼Œç”¨äºéªŒè¯è·¯ç”±å‚æ•°æ˜¯å¦æ»¡è¶³çº¦æŸï¼Œè¿”å›<code>true</code>è¡¨ç¤ºæ»¡è¶³çº¦æŸï¼Œ<code>false</code>åˆ™è¡¨ç¤ºä¸æ»¡è¶³çº¦æŸã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹è¦æ±‚è·¯ç”±å‚æ•°ä¸­å¿…é¡»åŒ…å«å­—ç¬¦ä¸²â€œ1â€ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public class MyRouteConstraint : IRouteConstraint
{
    public bool Match(HttpContext httpContext, IRouter route, string routeKey, RouteValueDictionary values, RouteDirection routeDirection)
    {
        if (values.TryGetValue(routeKey, out object value))
        {
            var valueStr = Convert.ToString(value, CultureInfo.InvariantCulture);

            return valueStr?.Contains(&quot;1&quot;) ?? false;
        }

        return false;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åè¿›è¡Œè·¯ç”±çº¦æŸæ³¨å†Œï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public void ConfigureServices(IServiceCollection services)
{
    services.AddRouting(options =&gt;
    {
        // æ·»åŠ è‡ªå®šä¹‰è·¯ç”±çº¦æŸï¼Œçº¦æŸ Key ä¸º my
        options.ConstraintMap[&quot;my&quot;] = typeof(MyRouteConstraint);
    });
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åä½ å°±å¯ä»¥ç±»ä¼¼å¦‚ä¸‹è¿›è¡Œä½¿ç”¨äº†ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[HttpGet(&quot;{id:my}&quot;)]
public string Get(string id)
{
    return id;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="è·¯ç”±æ¨¡æ¿ä¼˜å…ˆçº§" tabindex="-1"><a class="header-anchor" href="#è·¯ç”±æ¨¡æ¿ä¼˜å…ˆçº§" aria-hidden="true">#</a> è·¯ç”±æ¨¡æ¿ä¼˜å…ˆçº§</h2><p>è€ƒè™‘ä¸€ä¸‹ï¼Œæœ‰ä¸¤ä¸ªè·¯ç”±æ¨¡æ¿ï¼š<code>/Book/List</code>å’Œ<code>/Book/{id}</code>ï¼Œå½“urlä¸º<code>/Book/List</code>æ—¶ï¼Œä¼šé€‰æ‹©å“ªä¸ªå‘¢ï¼Ÿä»ç»“æœæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œæ˜¯æ¨¡æ¿<code>/Book/List</code>ã€‚å®ƒæ˜¯æ ¹æ®ä»¥ä¸‹è§„åˆ™æ¥ç¡®å®šçš„ï¼š</p><ul><li>è¶Šå…·ä½“çš„æ¨¡æ¿ä¼˜å…ˆçº§è¶Šé«˜</li><li>åŒ…å«æ›´å¤šåŒ¹é…æ®µçš„æ¨¡æ¿æ›´å…·ä½“</li><li>å«æœ‰æ–‡æœ¬çš„æ®µæ¯”å‚æ•°æ®µæ›´å…·ä½“</li><li>å…·æœ‰çº¦æŸçš„å‚æ•°æ®µæ¯”æ²¡æœ‰çº¦æŸçš„å‚æ•°æ®µæ›´å…·ä½“</li><li>å¤æ‚æ®µå’Œå…·æœ‰çº¦æŸçš„æ®µåŒæ ·å…·ä½“</li><li><code>catch-all</code>å‚æ•°æ®µæ˜¯æœ€ä¸å…·ä½“çš„</li></ul><h1 id="æ ¸å¿ƒæºç è§£æ" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒæºç è§£æ" aria-hidden="true">#</a> æ ¸å¿ƒæºç è§£æ</h1><h1 id="addrouting" tabindex="-1"><a class="header-anchor" href="#addrouting" aria-hidden="true">#</a> AddRouting</h1><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public static class RoutingServiceCollectionExtensions
{
    public static IServiceCollection AddRouting(this IServiceCollection services)
    {
        // å†…è”çº¦æŸè§£æå™¨ï¼Œè´Ÿè´£åˆ›å»º IRouteConstraint å®ä¾‹
        services.TryAddTransient&lt;IInlineConstraintResolver, DefaultInlineConstraintResolver&gt;();
        // å¯¹è±¡æ± 
        services.TryAddTransient&lt;ObjectPoolProvider, DefaultObjectPoolProvider&gt;();
        services.TryAddSingleton&lt;ObjectPool&lt;UriBuildingContext&gt;&gt;(s =&gt;
        {
            var provider = s.GetRequiredService&lt;ObjectPoolProvider&gt;();
            return provider.Create&lt;UriBuildingContext&gt;(new UriBuilderContextPooledObjectPolicy());
        });

        services.TryAdd(ServiceDescriptor.Transient&lt;TreeRouteBuilder&gt;(s =&gt;
        {
            var loggerFactory = s.GetRequiredService&lt;ILoggerFactory&gt;();
            var objectPool = s.GetRequiredService&lt;ObjectPool&lt;UriBuildingContext&gt;&gt;();
            var constraintResolver = s.GetRequiredService&lt;IInlineConstraintResolver&gt;();
            return new TreeRouteBuilder(loggerFactory, objectPool, constraintResolver);
        }));

        // æ ‡è®°å·²å°†æ‰€æœ‰è·¯ç”±æœåŠ¡æ³¨å†Œå®Œæ¯•
        services.TryAddSingleton(typeof(RoutingMarkerService));

        var dataSources = new ObservableCollection&lt;EndpointDataSource&gt;();
        services.TryAddEnumerable(ServiceDescriptor.Transient&lt;IConfigureOptions&lt;RouteOptions&gt;, ConfigureRouteOptions&gt;(
            serviceProvider =&gt; new ConfigureRouteOptions(dataSources)));

        // EndpointDataSourceï¼Œç”¨äºå…¨å±€è®¿é—®ç»ˆç»“ç‚¹åˆ—è¡¨
        services.TryAddSingleton&lt;EndpointDataSource&gt;(s =&gt;
        {
            return new CompositeEndpointDataSource(dataSources);
        });

        services.TryAddSingleton&lt;ParameterPolicyFactory, DefaultParameterPolicyFactory&gt;();
        // MatcherFactoryï¼Œç”¨äºæ ¹æ® EndpointDataSource åˆ›å»º Matcher
        services.TryAddSingleton&lt;MatcherFactory, DfaMatcherFactory&gt;();
        // DfaMatcherBuilderï¼Œç”¨äºåˆ›å»º DfaMatcher å®ä¾‹
        services.TryAddTransient&lt;DfaMatcherBuilder&gt;();
        services.TryAddSingleton&lt;DfaGraphWriter&gt;();
        services.TryAddTransient&lt;DataSourceDependentMatcher.Lifetime&gt;();
        services.TryAddSingleton&lt;EndpointMetadataComparer&gt;(services =&gt;
        {
            return new EndpointMetadataComparer(services);
        });

        // LinkGeneratorç›¸å…³æœåŠ¡
        services.TryAddSingleton&lt;LinkGenerator, DefaultLinkGenerator&gt;();
        services.TryAddSingleton&lt;IEndpointAddressScheme&lt;string&gt;, EndpointNameAddressScheme&gt;();
        services.TryAddSingleton&lt;IEndpointAddressScheme&lt;RouteValuesAddress&gt;, RouteValuesAddressScheme&gt;();
        services.TryAddSingleton&lt;LinkParser, DefaultLinkParser&gt;();

        // ç»ˆç»“ç‚¹é€‰æ‹©ã€åŒ¹é…ç­–ç•¥ç›¸å…³æœåŠ¡
        services.TryAddSingleton&lt;EndpointSelector, DefaultEndpointSelector&gt;();
        services.TryAddEnumerable(ServiceDescriptor.Singleton&lt;MatcherPolicy, HttpMethodMatcherPolicy&gt;());
        services.TryAddEnumerable(ServiceDescriptor.Singleton&lt;MatcherPolicy, HostMatcherPolicy&gt;());

        services.TryAddSingleton&lt;TemplateBinderFactory, DefaultTemplateBinderFactory&gt;();
        services.TryAddSingleton&lt;RoutePatternTransformer, DefaultRoutePatternTransformer&gt;();
        return services;
    }

    public static IServiceCollection AddRouting(
        this IServiceCollection services,
        Action&lt;RouteOptions&gt; configureOptions)
    {
        services.Configure(configureOptions);
        services.AddRouting();

        return services;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="userouting" tabindex="-1"><a class="header-anchor" href="#userouting" aria-hidden="true">#</a> UseRouting</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public static class EndpointRoutingApplicationBuilderExtensions
{
    private const string EndpointRouteBuilder = &quot;__EndpointRouteBuilder&quot;;
    
    public static IApplicationBuilder UseRouting(this IApplicationBuilder builder)
    {
        VerifyRoutingServicesAreRegistered(builder);
    
        var endpointRouteBuilder = new DefaultEndpointRouteBuilder(builder);
        // å°† endpointRouteBuilder æ”¾å…¥å…±äº«å­—å…¸ä¸­
        builder.Properties[EndpointRouteBuilder] = endpointRouteBuilder;
    
        // å°† endpointRouteBuilder ä½œä¸ºæ„é€ å‡½æ•°å‚æ•°ä¼ å…¥ EndpointRoutingMiddleware
        return builder.UseMiddleware&lt;EndpointRoutingMiddleware&gt;(endpointRouteBuilder);
    }
    
    private static void VerifyRoutingServicesAreRegistered(IApplicationBuilder app)
    {
        // å¿…é¡»å…ˆæ‰§è¡Œäº† AddRouting
        if (app.ApplicationServices.GetService(typeof(RoutingMarkerService)) == null)
        {
            throw new InvalidOperationException(Resources.FormatUnableToFindServices(
                nameof(IServiceCollection),
                nameof(RoutingServiceCollectionExtensions.AddRouting),
                &quot;ConfigureServices(...)&quot;));
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="endpointroutingmiddleware" tabindex="-1"><a class="header-anchor" href="#endpointroutingmiddleware" aria-hidden="true">#</a> EndpointRoutingMiddleware</h3><p>ç»ˆäºåˆ°äº†è·¯ç”±åŒ¹é…çš„é€»è¾‘äº†ï¼Œæ‰æ˜¯æˆ‘ä»¬åº”è¯¥å…³æ³¨çš„ï¼Œé‡ç‚¹æŸ¥çœ‹<code>Invoke</code>ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>internal sealed class EndpointRoutingMiddleware
{
    private const string DiagnosticsEndpointMatchedKey = &quot;Microsoft.AspNetCore.Routing.EndpointMatched&quot;;

    private readonly MatcherFactory _matcherFactory;
    private readonly ILogger _logger;
    private readonly EndpointDataSource _endpointDataSource;
    private readonly DiagnosticListener _diagnosticListener;
    private readonly RequestDelegate _next;

    private Task&lt;Matcher&gt;? _initializationTask;

    public EndpointRoutingMiddleware(
        MatcherFactory matcherFactory,
        ILogger&lt;EndpointRoutingMiddleware&gt; logger,
        IEndpointRouteBuilder endpointRouteBuilder,
        DiagnosticListener diagnosticListener,
        RequestDelegate next)
    {
        _matcherFactory = matcherFactory ?? throw new ArgumentNullException(nameof(matcherFactory));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
        _diagnosticListener = diagnosticListener ?? throw new ArgumentNullException(nameof(diagnosticListener));
        _next = next ?? throw new ArgumentNullException(nameof(next));

        _endpointDataSource = new CompositeEndpointDataSource(endpointRouteBuilder.DataSources);
    }

    public Task Invoke(HttpContext httpContext)
    {
        // å·²ç»é€‰æ‹©äº†ç»ˆç»“ç‚¹ï¼Œåˆ™è·³è¿‡åŒ¹é…
        var endpoint = httpContext.GetEndpoint();
        if (endpoint != null)
        {
            Log.MatchSkipped(_logger, endpoint);
            return _next(httpContext);
        }

        // ç­‰å¾… _initializationTask åˆå§‹åŒ–å®Œæˆï¼Œè¿›è¡ŒåŒ¹é…ï¼Œå¹¶æµè½¬åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶
        var matcherTask = InitializeAsync();
        if (!matcherTask.IsCompletedSuccessfully)
        {
            return AwaitMatcher(this, httpContext, matcherTask);
        }
        
        // _initializationTaskåœ¨ä¹‹å‰å°±å·²ç»åˆå§‹åŒ–å®Œæˆäº†ï¼Œç›´æ¥è¿›è¡ŒåŒ¹é…ä»»åŠ¡ï¼Œå¹¶æµè½¬åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶
        var matchTask = matcherTask.Result.MatchAsync(httpContext);
        if (!matchTask.IsCompletedSuccessfully)
        {
            return AwaitMatch(this, httpContext, matchTask);
        }

        // æµè½¬åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶
        return SetRoutingAndContinue(httpContext);

        static async Task AwaitMatcher(EndpointRoutingMiddleware middleware, HttpContext httpContext, Task&lt;Matcher&gt; matcherTask)
        {
            var matcher = await matcherTask;
            // è·¯ç”±åŒ¹é…ï¼Œé€‰æ‹©ç»ˆç»“ç‚¹
            await matcher.MatchAsync(httpContext);
            await middleware.SetRoutingAndContinue(httpContext);
        }

        static async Task AwaitMatch(EndpointRoutingMiddleware middleware, HttpContext httpContext, Task matchTask)
        {
            await matchTask;
            await middleware.SetRoutingAndContinue(httpContext);
        }
    }

    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    private Task SetRoutingAndContinue(HttpContext httpContext)
    {
        // ç»ˆç»“ç‚¹ä»ç„¶ä¸ºç©ºï¼Œåˆ™åŒ¹é…å¤±è´¥
        var endpoint = httpContext.GetEndpoint();
        if (endpoint == null)
        {
            Log.MatchFailure(_logger);
        }
        else
        {
            // åŒ¹é…æˆåŠŸåˆ™è§¦å‘äº‹ä»¶
            if (_diagnosticListener.IsEnabled() &amp;&amp; _diagnosticListener.IsEnabled(DiagnosticsEndpointMatchedKey))
            {
                // httpContextå¯¹è±¡åŒ…å«äº†ç›¸å…³ä¿¡æ¯
                _diagnosticListener.Write(DiagnosticsEndpointMatchedKey, httpContext);
            }

            Log.MatchSuccess(_logger, endpoint);
        }

        // æµè½¬åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶
        return _next(httpContext);
    }

    private Task&lt;Matcher&gt; InitializeAsync()
    {
        var initializationTask = _initializationTask;
        if (initializationTask != null)
        {
            return initializationTask;
        }

        // æ­¤å¤„æˆ‘åˆ å‡äº†éƒ¨åˆ†çº¿ç¨‹ç«äº‰ä»£ç ï¼Œå› ä¸ºè¿™ä¸æ˜¯æˆ‘ä»¬è®¨è®ºçš„é‡ç‚¹
        // æ­¤å¤„ä¸»è¦ç›®çš„æ˜¯åœ¨è¯¥Middlewareä¸­ï¼Œç¡®ä¿åªåˆå§‹åŒ–_initializationTaskä¸€æ¬¡

        var matcher = _matcherFactory.CreateMatcher(_endpointDataSource);

        using (ExecutionContext.SuppressFlow())
        {
            _initializationTask = Task.FromResult(matcher);
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç çš„æ ¸å¿ƒå°±æ˜¯å°†<code>_endpointDataSource</code>ä¼ é€’ç»™<code>_matcherFactory</code>ï¼Œåˆ›å»º<code>matcher</code>ï¼Œç„¶åè¿›è¡ŒåŒ¹é…<code>matcher.MatchAsync(httpContext)</code>ã€‚<a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> Coreé»˜è®¤ä½¿ç”¨çš„ matcher ç±»å‹æ˜¯<code>DfaMatcher</code>ï¼ŒDFAï¼ˆDeterministic Finite Automatonï¼‰æ˜¯ä¸€ç§è¢«ç§°ä¸ºâ€œç¡®å®šæœ‰é™çŠ¶æ€è‡ªåŠ¨æœºâ€çš„ç®—æ³•ï¼Œå¯ä»¥ä»å€™é€‰ç»ˆç»“ç‚¹åˆ—è¡¨ä¸­æŸ¥æ‰¾åˆ°åŒ¹é…åº¦æœ€é«˜çš„é‚£ä¸ªç»ˆç»“ç‚¹ã€‚</p><p><strong>UseEndpoints</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public static class EndpointRoutingApplicationBuilderExtensions
{
    public static IApplicationBuilder UseEndpoints(this IApplicationBuilder builder, Action&lt;IEndpointRouteBuilder&gt; configure)
    {
        VerifyRoutingServicesAreRegistered(builder);

        VerifyEndpointRoutingMiddlewareIsRegistered(builder, out var endpointRouteBuilder);

        configure(endpointRouteBuilder);

        var routeOptions = builder.ApplicationServices.GetRequiredService&lt;IOptions&lt;RouteOptions&gt;&gt;();
        foreach (var dataSource in endpointRouteBuilder.DataSources)
        {
            routeOptions.Value.EndpointDataSources.Add(dataSource);
        }

        return builder.UseMiddleware&lt;EndpointMiddleware&gt;();
    }
    
    private static void VerifyEndpointRoutingMiddlewareIsRegistered(IApplicationBuilder app, out DefaultEndpointRouteBuilder endpointRouteBuilder)
    {
        // å°† endpointRouteBuilder ä»å…±äº«å­—å…¸ä¸­å–å‡ºæ¥ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è¯´æ˜ä¹‹å‰æ²¡æœ‰è°ƒç”¨ UseRouting
        if (!app.Properties.TryGetValue(EndpointRouteBuilder, out var obj))
        {
            var message =
                $&quot;{nameof(EndpointRoutingMiddleware)} matches endpoints setup by {nameof(EndpointMiddleware)} and so must be added to the request &quot; +
                $&quot;execution pipeline before {nameof(EndpointMiddleware)}. &quot; +
                $&quot;Please add {nameof(EndpointRoutingMiddleware)} by calling &#39;{nameof(IApplicationBuilder)}.{nameof(UseRouting)}&#39; inside the call &quot; +
                $&quot;to &#39;Configure(...)&#39; in the application startup code.&quot;;
            throw new InvalidOperationException(message);
        }

        endpointRouteBuilder = (DefaultEndpointRouteBuilder)obj!;

        // UseRouting å’Œ UseEndpoints å¿…é¡»æ·»åŠ åˆ°åŒä¸€ä¸ª IApplicationBuilder å®ä¾‹ä¸Š
        if (!object.ReferenceEquals(app, endpointRouteBuilder.ApplicationBuilder))
        {
            var message =
                $&quot;The {nameof(EndpointRoutingMiddleware)} and {nameof(EndpointMiddleware)} must be added to the same {nameof(IApplicationBuilder)} instance. &quot; +
                $&quot;To use Endpoint Routing with &#39;Map(...)&#39;, make sure to call &#39;{nameof(IApplicationBuilder)}.{nameof(UseRouting)}&#39; before &quot; +
                $&quot;&#39;{nameof(IApplicationBuilder)}.{nameof(UseEndpoints)}&#39; for each branch of the middleware pipeline.&quot;;
            throw new InvalidOperationException(message);
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="endpointmiddleware" tabindex="-1"><a class="header-anchor" href="#endpointmiddleware" aria-hidden="true">#</a> EndpointMiddleware</h3><p><code>EndpointMiddleware</code>ä¸­é—´ä»¶ä¸­åŒ…å«äº†å¾ˆå¤šå¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•ä»£ç ï¼Œä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹æ ¸å¿ƒé€»è¾‘ï¼Œæˆ‘éƒ½åˆ é™¤å¹¶è¿›è¡Œäº†ç®€åŒ–ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>internal sealed class EndpointMiddleware
{
    internal const string AuthorizationMiddlewareInvokedKey = &quot;__AuthorizationMiddlewareWithEndpointInvoked&quot;;
    internal const string CorsMiddlewareInvokedKey = &quot;__CorsMiddlewareWithEndpointInvoked&quot;;

    private readonly ILogger _logger;
    private readonly RequestDelegate _next;
    private readonly RouteOptions _routeOptions;

    public EndpointMiddleware(
        ILogger&lt;EndpointMiddleware&gt; logger,
        RequestDelegate next,
        IOptions&lt;RouteOptions&gt; routeOptions)
    {
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
        _next = next ?? throw new ArgumentNullException(nameof(next));
        _routeOptions = routeOptions?.Value ?? throw new ArgumentNullException(nameof(routeOptions));
    }

    public Task Invoke(HttpContext httpContext)
    {
        var endpoint = httpContext.GetEndpoint();
        if (endpoint?.RequestDelegate != null)
        {
            // æ‰§è¡Œè¯¥ç»ˆç»“ç‚¹çš„å§”æ‰˜ï¼Œå¹¶ä¸”è§†è¯¥ä¸­é—´ä»¶ä¸ºç»ˆç«¯ä¸­é—´ä»¶
            var requestTask = endpoint.RequestDelegate(httpContext);
            if (!requestTask.IsCompletedSuccessfully)
            {
                return requestTask;
            }

            return Task.CompletedTask;
        }
        
        // è‹¥æ²¡æœ‰ç»ˆç»“ç‚¹ï¼Œåˆ™ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶
        return _next(httpContext);
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h1><p>è¯´äº†é‚£ä¹ˆå¤šï¼Œæœ€åç»™å¤§å®¶æ€»ç»“äº†ä¸‰å¼ UMLç±»å›¾ï¼š</p><p><strong>RoutePattern</strong><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/7fxWIIIo4Qs3k4FurMojaRNCW3fBdEmIysibicSpQ5QARefCDzU4Vz9ibWbGKg75SSOIDq4eDmiahWrZklzWYZo30A/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡" loading="lazy"></p><p><strong>EndPoint</strong><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/7fxWIIIo4Qs3k4FurMojaRNCW3fBdEmIZMqZhtjt39Rw6bWYw0pfLg1nicyajia4EjO6uM2kjfpunT6hc0QkxICQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡" loading="lazy"></p><p><strong>Matcher</strong><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/7fxWIIIo4Qs3k4FurMojaRNCW3fBdEmIEcia3E91cxKqP45xJjibqlPJSX8eUQXTm6WmWMvQMz5eiaEcpZb9Qk47Q/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡" loading="lazy"></p><p>å¦å¤–ï¼Œæœ¬æ–‡ä»…ä»…æåˆ°äº†è·¯ç”±çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼å’ŒåŸç†ï¼Œå¦‚æœä½ æƒ³è¦è¿›è¡Œæ›´åŠ æ·±å…¥é€å½»çš„äº†è§£ï¼Œ<a href="http://xn--ASP-qg2fh2w88i32xflr0zg99cns3aj6pu1m.NET" target="_blank" rel="noopener noreferrer">æ¨èé˜…è¯»è’‹é‡‘æ¥ è€å¸ˆçš„ASP.NET<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> Core 3æ¡†æ¶æ­ç§˜çš„è·¯ç”±éƒ¨åˆ†ã€‚</p><h1 id="èµ„æ–™" tabindex="-1"><a class="header-anchor" href="#èµ„æ–™" aria-hidden="true">#</a> èµ„æ–™</h1><p>è½¬è‡ªï¼šxiaoxiaotank é“¾æ¥ï¼š<a href="http://cnblogs.com/xiaoxiaotank/p/15468491.html" target="_blank" rel="noopener noreferrer">cnblogs.com/xiaoxiaotank/p/15468491.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/docs/dotnetcore/routing.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: zhang.yunpeng@synyi.com">zhangyunpeng</span>,<!--]--><!--[--><span class="contributor" title="email: itzhangyunpeng@163.com">azrng</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/kbms/dotnetcore/globalization.html" class="nav-link prev" aria-label="å¤šè¯­è¨€é…ç½®"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->å¤šè¯­è¨€é…ç½®</div></a><a href="/kbms/dotnetcore/healthcheck.html" class="nav-link next" aria-label="å¥åº·æ£€æŸ¥"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">å¥åº·æ£€æŸ¥<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright Â© 2022 azrng</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/kbms/assets/app.2bd5222d.js" defer></script>
  </body>
</html>
